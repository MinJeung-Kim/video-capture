"use strict";var RTCMultiConnection=function(c,w){var v=false;var E="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";(function(O){if(!O){return}if(typeof window!=="undefined"){return}if(typeof global==="undefined"){return}global.navigator={userAgent:E,getUserMedia:function(){}};if(!global.console){global.console={}}if(typeof global.console.debug==="undefined"){global.console.debug=global.console.info=global.console.error=global.console.log=global.console.log||function(){console.log(arguments)}}if(typeof document==="undefined"){O.document={};document.createElement=document.captureStream=document.mozCaptureStream=function(){var P={getContext:function(){return P},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""}};return P};document.addEventListener=document.removeEventListener=O.addEventListener=O.removeEventListener=function(){};O.HTMLVideoElement=O.HTMLMediaElement=function(){}}if(typeof io==="undefined"){O.io=function(){return{on:function(P,Q){Q=Q||function(){};if(P==="connect"){Q()}},emit:function(P,Q,R){R=R||function(){};if(P==="open-room"||P==="join-room"){R(true,Q.sessionid,null)}}}}}if(typeof location==="undefined"){O.location={protocol:"file:",href:"",hash:"",origin:"self"}}if(typeof screen==="undefined"){O.screen={width:0,height:0}}if(typeof URL==="undefined"){O.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}}O.window=global})(typeof global!=="undefined"?global:null);function g(P,T){function W(X){return !X.audio&&!X.video&&!X.screen&&X.data}var V="";V+="?userid="+P.userid;V+="&sessionid="+P.sessionid;V+="&msgEvent="+P.socketMessageEvent;V+="&socketCustomEvent="+P.socketCustomEvent;V+="&autoCloseEntireSession="+!!P.autoCloseEntireSession;if(P.session.broadcast===true){V+="&oneToMany=true"}V+="&maxParticipantsAllowed="+P.maxParticipantsAllowed;if(P.enableScalableBroadcast){V+="&enableScalableBroadcast=true";V+="&maxRelayLimitPerUser="+(P.maxRelayLimitPerUser||2)}V+="&extra="+JSON.stringify(P.extra||{});if(P.socketCustomParameters){V+=P.socketCustomParameters}try{io.sockets={}}catch(S){}if(!P.socketURL){P.socketURL="/"}if(P.socketURL.substr(P.socketURL.length-1,1)!="/"){throw'"socketURL" MUST end with a slash.'}if(P.enableLogs){if(P.socketURL=="/"){console.info("socket.io url is: ",location.origin+"/")}else{console.info("socket.io url is: ",P.socketURL)}}try{P.socket=io(P.socketURL+V)}catch(S){P.socket=io.connect(P.socketURL+V,P.socketOptions)}var R=P.multiPeersHandler;P.socket.on("extra-data-updated",function(Y,X){if(!P.peers[Y]){return}P.peers[Y].extra=X;P.onExtraDataUpdated({userid:Y,extra:X});Q(Y,X)});function Q(Y,X){if(!P.peersBackup[Y]){P.peersBackup[Y]={userid:Y,extra:{}}}P.peersBackup[Y].extra=X}function U(Y){if(Y.remoteUserId!=P.userid){return}if(P.peers[Y.sender]&&P.peers[Y.sender].extra!=Y.message.extra){P.peers[Y.sender].extra=Y.extra;P.onExtraDataUpdated({userid:Y.sender,extra:Y.extra});Q(Y.sender,Y.extra)}if(Y.message.streamSyncNeeded&&P.peers[Y.sender]){var ab=P.streamEvents[Y.message.streamid];if(!ab||!ab.stream){return}var Z=Y.message.action;if(Z==="ended"||Z==="inactive"||Z==="stream-removed"){if(P.peersBackup[ab.userid]){ab.extra=P.peersBackup[ab.userid].extra}P.onstreamended(ab);return}var X=Y.message.type!="both"?Y.message.type:null;if(typeof ab.stream[Z]=="function"){ab.stream[Z](X)}return}if(Y.message==="dropPeerConnection"){P.deletePeer(Y.sender);return}if(Y.message.allParticipants){if(Y.message.allParticipants.indexOf(Y.sender)===-1){Y.message.allParticipants.push(Y.sender)}Y.message.allParticipants.forEach(function(ac){R[!P.peers[ac]?"createNewPeer":"renegotiatePeer"](ac,{localPeerSdpConstraints:{OfferToReceiveAudio:P.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:P.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:P.session.oneway?!!P.session.audio:P.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:P.session.oneway?!!P.session.video||!!P.session.screen:P.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!P.session.oneway||P.direction==="one-way",isDataOnly:W(P.session)})});return}if(Y.message.newParticipant){if(Y.message.newParticipant==P.userid){return}if(!!P.peers[Y.message.newParticipant]){return}R.createNewPeer(Y.message.newParticipant,Y.message.userPreferences||{localPeerSdpConstraints:{OfferToReceiveAudio:P.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:P.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:P.session.oneway?!!P.session.audio:P.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:P.session.oneway?!!P.session.video||!!P.session.screen:P.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!P.session.oneway||P.direction==="one-way",isDataOnly:W(P.session)});return}if(Y.message.readyForOffer){if(P.attachStreams.length){P.waitingForLocalMedia=false}if(P.waitingForLocalMedia){setTimeout(function(){U(Y)},1);return}}if(Y.message.newParticipationRequest&&Y.sender!==P.userid){if(P.peers[Y.sender]){P.deletePeer(Y.sender)}var aa={extra:Y.extra||{},localPeerSdpConstraints:Y.message.remotePeerSdpConstraints||{OfferToReceiveAudio:P.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:P.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:Y.message.localPeerSdpConstraints||{OfferToReceiveAudio:P.session.oneway?!!P.session.audio:P.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:P.session.oneway?!!P.session.video||!!P.session.screen:P.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:typeof Y.message.isOneWay!=="undefined"?Y.message.isOneWay:!!P.session.oneway||P.direction==="one-way",isDataOnly:typeof Y.message.isDataOnly!=="undefined"?Y.message.isDataOnly:W(P.session),dontGetRemoteStream:typeof Y.message.isOneWay!=="undefined"?Y.message.isOneWay:!!P.session.oneway||P.direction==="one-way",dontAttachLocalStream:!!Y.message.dontGetRemoteStream,connectionDescription:Y,successCallback:function(){}};P.onNewParticipant(Y.sender,aa);return}if(Y.message.changedUUID){if(P.peers[Y.message.oldUUID]){P.peers[Y.message.newUUID]=P.peers[Y.message.oldUUID];delete P.peers[Y.message.oldUUID]}}if(Y.message.userLeft){R.onUserLeft(Y.sender);if(!!Y.message.autoCloseEntireSession){P.leave()}return}R.addNegotiatedMessage(Y.message,Y.sender)}P.socket.on(P.socketMessageEvent,U);var O=false;P.socket.resetProps=function(){O=false};P.socket.on("connect",function(){if(O){return}O=true;if(P.enableLogs){console.info("socket.io connection is opened.")}setTimeout(function(){P.socket.emit("extra-data-updated",P.extra)},1000);if(T){T(P.socket)}});P.socket.on("disconnect",function(X){P.onSocketDisconnect(X)});P.socket.on("error",function(X){P.onSocketError(X)});P.socket.on("user-disconnected",function(X){if(X===P.userid){return}P.onUserStatusChanged({userid:X,status:"offline",extra:P.peers[X]?P.peers[X].extra||{}:{}});P.deletePeer(X)});P.socket.on("user-connected",function(X){if(X===P.userid){return}P.onUserStatusChanged({userid:X,status:"online",extra:P.peers[X]?P.peers[X].extra||{}:{}})});P.socket.on("closed-entire-session",function(Y,X){P.leave();P.onEntireSessionClosed({sessionid:Y,userid:Y,extra:X})});P.socket.on("userid-already-taken",function(X,Y){P.onUserIdAlreadyTaken(X,Y)});P.socket.on("logs",function(X){if(!P.enableLogs){return}console.debug("server-logs",X)});P.socket.on("number-of-broadcast-viewers-updated",function(X){P.onNumberOfBroadcastViewersUpdated(X)});P.socket.on("set-isInitiator-true",function(X){if(X!=P.sessionid){return}P.isInitiator=true})}function l(Q){var P=this;var S=["getAllParticipants","getLength","selectFirst","streams","send","forEach"];Q.peers={getLength:function(){var V=0;for(var U in this){if(S.indexOf(U)==-1){V++}}return V},selectFirst:function(){var V;for(var U in this){if(S.indexOf(U)==-1){V=this[U]}}return V},getAllParticipants:function(V){var U=[];for(var W in this){if(S.indexOf(W)==-1&&W!=V){U.push(W)}}return U},forEach:function(U){this.getAllParticipants().forEach(function(V){U(Q.peers[V])})},send:function(W,X){var U=this;if(!H(W.size)&&!H(W.type)){if(Q.enableFileSharing){P.shareFile(W,X);return}if(typeof W!=="string"){W=JSON.stringify(W)}}if(W.type!=="text"&&!(W instanceof ArrayBuffer)&&!(W instanceof DataView)){D.send({text:W,channel:this,connection:Q,remoteUserId:X});return}if(W.type==="text"){W=JSON.stringify(W)}if(X){var V=Q.peers[X];if(V){if(!V.channels.length){Q.peers[X].createDataChannel();Q.renegotiate(X);setTimeout(function(){U.send(W,X)},3000);return}V.channels.forEach(function(Y){Y.send(W)});return}}this.getAllParticipants().forEach(function(Y){if(!U[Y].channels.length){Q.peers[Y].createDataChannel();Q.renegotiate(Y);setTimeout(function(){U[Y].channels.forEach(function(Z){Z.send(W)})},3000);return}U[Y].channels.forEach(function(Z){Z.send(W)})})}};this.uuid=Q.userid;this.getLocalConfig=function(U,V,W){if(!W){W={}}return{streamsToShare:W.streamsToShare||{},rtcMultiConnection:Q,connectionDescription:W.connectionDescription,userid:V,localPeerSdpConstraints:W.localPeerSdpConstraints,remotePeerSdpConstraints:W.remotePeerSdpConstraints,dontGetRemoteStream:!!W.dontGetRemoteStream,dontAttachLocalStream:!!W.dontAttachLocalStream,renegotiatingPeer:!!W.renegotiatingPeer,peerRef:W.peerRef,channels:W.channels||[],onLocalSdp:function(X){P.onNegotiationNeeded(X,V)},onLocalCandidate:function(X){X=z.processCandidates(Q,X);if(X){P.onNegotiationNeeded(X,V)}},remoteSdp:U,onDataChannelMessage:function(Y){if(!Q.fbr&&Q.enableFileSharing){T()}if(typeof Y=="string"||!Q.enableFileSharing){P.onDataChannelMessage(Y,V);return}var X=this;if(Y instanceof ArrayBuffer||Y instanceof DataView){Q.fbr.convertToObject(Y,function(Z){X.onDataChannelMessage(Z)});return}if(Y.readyForNextChunk){Q.fbr.getNextChunk(Y,function(Z,aa){Q.peers[V].channels.forEach(function(ab){ab.send(Z)})},V);return}if(Y.chunkMissing){Q.fbr.chunkMissing(Y);return}Q.fbr.addChunk(Y,function(Z){Q.peers[V].peer.channel.send(Z)})},onDataChannelError:function(X){P.onDataChannelError(X,V)},onDataChannelOpened:function(X){P.onDataChannelOpened(X,V)},onDataChannelClosed:function(X){P.onDataChannelClosed(X,V)},onRemoteStream:function(X){if(Q.peers[V]){Q.peers[V].streams.push(X)}P.onGettingRemoteMedia(X,V)},onRemoteStreamRemoved:function(X){P.onRemovingRemoteMedia(X,V)},onPeerStateChanged:function(X){P.onPeerStateChanged(X);if(X.iceConnectionState==="new"){P.onNegotiationStarted(V,X)}if(X.iceConnectionState==="connected"){P.onNegotiationCompleted(V,X)}if(X.iceConnectionState.search(/closed|failed/gi)!==-1){P.onUserLeft(V);P.disconnectWith(V)}}}};this.createNewPeer=function(V,W){if(Q.maxParticipantsAllowed<=Q.getAllParticipants().length){return}W=W||{};if(Q.isInitiator&&!!Q.session.audio&&Q.session.audio==="two-way"&&!W.streamsToShare){W.isOneWay=false;W.isDataOnly=false;W.session=Q.session}if(!W.isOneWay&&!W.isDataOnly){W.isOneWay=true;this.onNegotiationNeeded({enableMedia:true,userPreferences:W},V);return}W=Q.setUserPreferences(W,V);var U=this.getLocalConfig(null,V,W);Q.peers[V]=new o(U)};this.createAnsweringPeer=function(U,W,X){X=Q.setUserPreferences(X||{},W);var V=this.getLocalConfig(U,W,X);Q.peers[W]=new o(V)};this.renegotiatePeer=function(W,X,U){if(!Q.peers[W]){if(Q.enableLogs){console.error("Peer ("+W+") does not exist. Renegotiation skipped.")}return}if(!X){X={}}X.renegotiatingPeer=true;X.peerRef=Q.peers[W].peer;X.channels=Q.peers[W].channels;var V=this.getLocalConfig(U,W,X);Q.peers[W]=new o(V)};this.replaceTrack=function(U,X,V){if(!Q.peers[X]){throw"This peer ("+X+") does not exist."}var W=Q.peers[X].peer;if(!!W.getSenders&&typeof W.getSenders==="function"&&W.getSenders().length){W.getSenders().forEach(function(Y){if(V&&Y.track.kind==="video"){Q.peers[X].peer.lastVideoTrack=Y.track;Y.replaceTrack(U)}if(!V&&Y.track.kind==="audio"){Q.peers[X].peer.lastAudioTrack=Y.track;Y.replaceTrack(U)}});return}console.warn("RTPSender.replaceTrack is NOT supported.");this.renegotiatePeer(X)};this.onNegotiationNeeded=function(U,V){};this.addNegotiatedMessage=function(W,X){if(W.type&&W.sdp){if(W.type=="answer"){if(Q.peers[X]){Q.peers[X].addRemoteSdp(W)}}if(W.type=="offer"){if(W.renegotiatingPeer){this.renegotiatePeer(X,null,W)}else{this.createAnsweringPeer(W,X)}}if(Q.enableLogs){console.log("Remote peer's sdp:",W.sdp)}return}if(W.candidate){if(Q.peers[X]){Q.peers[X].addRemoteCandidate(W)}if(Q.enableLogs){console.log("Remote peer's candidate pairs:",W.candidate)}return}if(W.enableMedia){Q.session=W.userPreferences.session||Q.session;if(Q.session.oneway&&Q.attachStreams.length){Q.attachStreams=[]}if(W.userPreferences.isDataOnly&&Q.attachStreams.length){Q.attachStreams.length=[]}var V={};Q.attachStreams.forEach(function(Y){V[Y.streamid]={isAudio:!!Y.isAudio,isVideo:!!Y.isVideo,isScreen:!!Y.isScreen}});W.userPreferences.streamsToShare=V;P.onNegotiationNeeded({readyForOffer:true,userPreferences:W.userPreferences},X)}if(W.readyForOffer){Q.onReadyForOffer(X,W.userPreferences)}function U(Y){O(Y,W,X)}};function O(X,V,W){var U={};Q.attachStreams.forEach(function(Y){U[Y.streamid]={isAudio:!!Y.isAudio,isVideo:!!Y.isVideo,isScreen:!!Y.isScreen}});V.userPreferences.streamsToShare=U;P.onNegotiationNeeded({readyForOffer:true,userPreferences:V.userPreferences},W)}this.onGettingRemoteMedia=function(V,U){};this.onRemovingRemoteMedia=function(V,U){};this.onGettingLocalMedia=function(U){};this.onLocalMediaError=function(U,V){Q.onMediaError(U,V)};function T(){Q.fbr=new FileBufferReader();Q.fbr.onProgress=function(U){Q.onFileProgress(U)};Q.fbr.onBegin=function(U){Q.onFileStart(U)};Q.fbr.onEnd=function(U){Q.onFileEnd(U)}}this.shareFile=function(U,V){T();Q.fbr.readAsArrayBuffer(U,function(W){var X=Q.getAllParticipants();if(V){X=[V]}X.forEach(function(Y){Q.fbr.getNextChunk(W,function(Z){Q.peers[Y].channels.forEach(function(aa){aa.send(Z)})},Y)})},{userid:Q.userid,chunkSize:DetectRTC.browser.name==="Firefox"?15*1000:Q.chunkSize||0})};if(typeof"TextReceiver"!=="undefined"){var R=new d(Q)}this.onDataChannelMessage=function(U,V){R.receive(JSON.parse(U),V,Q.peers[V]?Q.peers[V].extra:{})};this.onDataChannelClosed=function(U,V){U.userid=V;U.extra=Q.peers[V]?Q.peers[V].extra:{};Q.onclose(U)};this.onDataChannelError=function(U,V){U.userid=V;event.extra=Q.peers[V]?Q.peers[V].extra:{};Q.onerror(U)};this.onDataChannelOpened=function(U,V){if(Q.peers[V].channels.length){Q.peers[V].channels=[U];return}Q.peers[V].channels.push(U);Q.onopen({userid:V,extra:Q.peers[V]?Q.peers[V].extra:{},channel:U})};this.onPeerStateChanged=function(U){Q.onPeerStateChanged(U)};this.onNegotiationStarted=function(V,U){};this.onNegotiationCompleted=function(V,U){};this.getRemoteStreams=function(U){U=U||Q.peers.getAllParticipants()[0];return Q.peers[U]?Q.peers[U].streams:[]}}"use strict";(function(){var aF="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";var aM=typeof process==="object"&&typeof process.versions==="object"&&process.versions.node&&!process.browser;if(aM){var aL=process.versions.node.toString().replace("v","");aF="Nodejs/"+aL+" (NodeOS) AppleWebKit/"+aL+" (KHTML, like Gecko) Nodejs/"+aL+" Nodejs/"+aL}(function(aW){if(typeof window!=="undefined"){return}if(typeof window==="undefined"&&typeof global!=="undefined"){global.navigator={userAgent:aF,getUserMedia:function(){}};aW.window=global}else{if(typeof window==="undefined"){}}if(typeof location==="undefined"){aW.location={protocol:"file:",href:"",hash:""}}if(typeof screen==="undefined"){aW.screen={width:0,height:0}}})(typeof global!=="undefined"?global:window);var aD=window.navigator;if(typeof aD!=="undefined"){if(typeof aD.webkitGetUserMedia!=="undefined"){aD.getUserMedia=aD.webkitGetUserMedia}if(typeof aD.mozGetUserMedia!=="undefined"){aD.getUserMedia=aD.mozGetUserMedia}}else{aD={getUserMedia:function(){},userAgent:aF}}var ag=!!(/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(aD.userAgent||""));var aG=aD.userAgent.indexOf("Edge")!==-1&&(!!aD.msSaveOrOpenBlob||!!aD.msSaveBlob);var P=!!window.opera||aD.userAgent.indexOf(" OPR/")>=0;var S=typeof window.InstallTrigger!=="undefined";var W=/^((?!chrome|android).)*safari/i.test(aD.userAgent);var aO=!!window.chrome&&!P;var ac=typeof document!=="undefined"&&!!document.documentMode&&!aG;function ar(){var a3=aD.appVersion;var aZ=aD.userAgent;var a1=aD.appName;var a2=""+parseFloat(aD.appVersion);var aY=parseInt(aD.appVersion,10);var a4,aW,aX;if(W&&!aO&&aZ.indexOf("CriOS")!==-1){W=false;aO=true}if(P){a1="Opera";try{a2=aD.userAgent.split("OPR/")[1].split(" ")[0];aY=a2.split(".")[0]}catch(a0){a2="0.0.0.0";aY=0}}else{if(ac){aW=aZ.indexOf("rv:");if(aW>0){a2=aZ.substring(aW+3)}else{aW=aZ.indexOf("MSIE");a2=aZ.substring(aW+5)}a1="IE"}else{if(aO){aW=aZ.indexOf("Chrome");a1="Chrome";a2=aZ.substring(aW+7)}else{if(W){aW=aZ.indexOf("Safari");a1="Safari";a2=aZ.substring(aW+7);if((aW=aZ.indexOf("Version"))!==-1){a2=aZ.substring(aW+8)}if(aD.userAgent.indexOf("Version/")!==-1){a2=aD.userAgent.split("Version/")[1].split(" ")[0]}}else{if(S){aW=aZ.indexOf("Firefox");a1="Firefox";a2=aZ.substring(aW+8)}else{if((a4=aZ.lastIndexOf(" ")+1)<(aW=aZ.lastIndexOf("/"))){a1=aZ.substring(a4,aW);a2=aZ.substring(aW+1);if(a1.toLowerCase()===a1.toUpperCase()){a1=aD.appName}}}}}}}if(aG){a1="Edge";a2=aD.userAgent.split("Edge/")[1]}if((aX=a2.search(/[; \)]/))!==-1){a2=a2.substring(0,aX)}aY=parseInt(""+a2,10);if(isNaN(aY)){a2=""+parseFloat(aD.appVersion);aY=parseInt(aD.appVersion,10)}return{fullVersion:a2,version:aY,name:a1,isPrivateBrowsing:false}}function ai(aZ,a0){var a1=0,aY=50,aX=10,aW=false;var a2=window.setInterval(function(){if(aZ()){window.clearInterval(a2);a0(aW)}if(a1++>aY){window.clearInterval(a2);aW=true;a0(aW)}},10)}function aI(aY){var aX=aY.toLowerCase();if(aX.indexOf("msie")===0&&aX.indexOf("trident")===0){return false}var aW=/(?:msie|rv:)\s?([\d\.]+)/.exec(aX);if(aW&&parseInt(aW[1],10)>=10){return true}return false}function aq(a1){var aZ;try{if(window.webkitRequestFileSystem){window.webkitRequestFileSystem(window.TEMPORARY,1,function(){aZ=false},function(a2){aZ=true})}else{if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var aX;try{aX=window.indexedDB.open("test");aX.onerror=function(){return true}}catch(a0){aZ=true}if(typeof aZ==="undefined"){ai(function aW(){return aX.readyState==="done"?true:false},function aY(a2){if(!a2){aZ=aX.result?false:true}})}}else{if(aI(window.navigator.userAgent)){aZ=false;try{if(!window.indexedDB){aZ=true}}catch(a0){aZ=true}}else{if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("test",1)}catch(a0){aZ=true}if(typeof aZ==="undefined"){aZ=false;window.localStorage.removeItem("test")}}}}}}catch(a0){aZ=false}ai(function aW(){return typeof aZ!=="undefined"?true:false},function aY(a2){a1(aZ)})}var ax={Android:function(){return aD.userAgent.match(/Android/i)},BlackBerry:function(){return aD.userAgent.match(/BlackBerry|BB10/i)},iOS:function(){return aD.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return aD.userAgent.match(/Opera Mini/i)},Windows:function(){return aD.userAgent.match(/IEMobile/i)},any:function(){return(ax.Android()||ax.BlackBerry()||ax.iOS()||ax.Opera()||ax.Windows())},getOsName:function(){var aW="Unknown OS";if(ax.Android()){aW="Android"}if(ax.BlackBerry()){aW="BlackBerry"}if(ax.iOS()){aW="iOS"}if(ax.Opera()){aW="Opera Mini"}if(ax.Windows()){aW="Windows"}return aW}};function ao(){var a2="-";var a1=aD.appVersion;var aZ=aD.userAgent;var a0=a2;var aW=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var aX=0,aY;aY=aW[aX];aX++){if(aY.r.test(aZ)){a0=aY.s;break}}var a3=a2;if(/Windows/.test(a0)){if(/Windows (.*)/.test(a0)){a3=/Windows (.*)/.exec(a0)[1]}a0="Windows"}switch(a0){case"Mac OS X":if(/Mac OS X (10[\.\_\d]+)/.test(aZ)){a3=/Mac OS X (10[\.\_\d]+)/.exec(aZ)[1]}break;case"Android":if(/Android ([\.\_\d]+)/.test(aZ)){a3=/Android ([\.\_\d]+)/.exec(aZ)[1]}break;case"iOS":if(/OS (\d+)_(\d+)_?(\d+)?/.test(aZ)){a3=/OS (\d+)_(\d+)_?(\d+)?/.exec(a1);a3=a3[1]+"."+a3[2]+"."+(a3[3]|0)}break}return{osName:a0,osVersion:a3}}var aT="Unknown OS";var V="Unknown OS Version";function aH(aX){aX=(aX||aD.userAgent).toLowerCase();var aW=aX.match(/android\s([0-9\.]*)/);return aW?aW[1]:false}var aw=ao();if(aw&&aw.osName&&aw.osName!="-"){aT=aw.osName;V=aw.osVersion}else{if(ax.any()){aT=ax.getOsName();if(aT=="Android"){V=aH()}}}var aM=typeof process==="object"&&typeof process.versions==="object"&&process.versions.node;if(aT==="Unknown OS"&&aM){aT="Nodejs";V=process.versions.node.toString().replace("v","")}var aK=false;var aA=false;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(aW){if(typeof document==="undefined"||typeof document.createElement!=="function"){return}if(!aK&&aW in document.createElement("canvas")){aK=true}if(!aA&&aW in document.createElement("video")){aA=true}});var aU=/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/,aR=/([0-9]{1,3}(\.[0-9]{1,3}){3})/,aN=/[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7}/;function aB(aZ,aY){if(!ab.isWebRTCSupported){return}var aX=true,aW=true;ak(function(a0){if(!a0){aZ()}else{if(a0.match(aU)){aX=false;aZ("Local: "+a0,aX,aW)}else{if(a0.match(aN)){aW=false;aZ("Public: "+a0,aX,aW)}else{aZ("Public: "+a0,aX,aW)}}}},aY)}function ak(a5,a6){if(typeof document==="undefined"||typeof document.getElementById!=="function"){return}var a7={};var a1=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;if(!a1){var aX=document.getElementById("iframe");if(!aX){return}var aZ=aX.contentWindow;a1=aZ.RTCPeerConnection||aZ.mozRTCPeerConnection||aZ.webkitRTCPeerConnection}if(!a1){return}var a2=null;if(ab.browser==="Chrome"&&ab.browser.version<58){a2={optional:[{RtpDataChannels:true}]}}var a4={iceServers:[{urls:"stun:stun.l.google.com:19302"}]};var a3=new a1(a4,a2);if(a6){if(a3.addStream){a3.addStream(a6)}else{if(a3.addTrack&&a6.getTracks()[0]){a3.addTrack(a6.getTracks()[0],a6)}}}function aY(bb){if(!bb){a5();return}var a8=aR.exec(bb);if(!a8){return}var ba=a8[1];var bc=(bb.match(aU)),a9=true;if(a7[ba]===undefined){a5(ba,bc,a9)}a7[ba]=true}a3.onicecandidate=function(a8){if(a8.candidate&&a8.candidate.candidate){aY(a8.candidate.candidate)}else{aY()}};if(!a6){try{a3.createDataChannel("sctp",{})}catch(a0){}}if(ab.isPromisesSupported){a3.createOffer().then(function(a8){a3.setLocalDescription(a8).then(aW)})}else{a3.createOffer(function(a8){a3.setLocalDescription(a8,aW,function(){})},function(){})}function aW(){var a8=a3.localDescription.sdp.split("\n");a8.forEach(function(a9){if(a9&&a9.indexOf("a=candidate:")===0){aY(a9)}})}}var Z=[];var ap=[];var aC=[];var au=[];if(aD.mediaDevices&&aD.mediaDevices.enumerateDevices){aD.enumerateDevices=function(aX){var aW=aD.mediaDevices.enumerateDevices();if(aW&&aW.then){aD.mediaDevices.enumerateDevices().then(aX).catch(function(){aX([])})}else{aX([])}}}var U=false;if(typeof a!=="undefined"&&"getSources" in a){U=true}else{if(aD.mediaDevices&&!!aD.mediaDevices.enumerateDevices){U=true}}var ay=false;var aE=false;var al=false;var at=false;var aQ=false;function X(aX){if(!U){if(aX){aX()}return}if(!aD.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources){aD.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)}if(!aD.enumerateDevices&&aD.enumerateDevices){aD.enumerateDevices=aD.enumerateDevices.bind(aD)}if(!aD.enumerateDevices){if(aX){aX()}return}Z=[];ap=[];aC=[];au=[];ay=false;aE=false;al=false;at=false;aQ=false;var aW={};aD.enumerateDevices(function(aY){aY.forEach(function(a2){var aZ={};for(var a1 in a2){try{if(typeof a2[a1]!=="function"){aZ[a1]=a2[a1]}}catch(a0){}}if(aW[aZ.deviceId+aZ.label+aZ.kind]){return}if(aZ.kind==="audio"){aZ.kind="audioinput"}if(aZ.kind==="video"){aZ.kind="videoinput"}if(!aZ.deviceId){aZ.deviceId=aZ.id}if(!aZ.id){aZ.id=aZ.deviceId}if(!aZ.label){aZ.isCustomLabel=true;if(aZ.kind==="videoinput"){aZ.label="Camera "+(au.length+1)}else{if(aZ.kind==="audioinput"){aZ.label="Microphone "+(ap.length+1)}else{if(aZ.kind==="audiooutput"){aZ.label="Speaker "+(aC.length+1)}else{aZ.label="Please invoke getUserMedia once."}}}if(typeof ab!=="undefined"&&ab.browser.isChrome&&ab.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")){if(typeof document!=="undefined"&&typeof document.domain==="string"&&document.domain.search&&document.domain.search(/localhost|127.0./g)===-1){aZ.label="HTTPs is required to get label of this "+aZ.kind+" device."}}}else{if(aZ.kind==="videoinput"&&!aQ){aQ=true}if(aZ.kind==="audioinput"&&!at){at=true}}if(aZ.kind==="audioinput"){ay=true;if(ap.indexOf(aZ)===-1){ap.push(aZ)}}if(aZ.kind==="audiooutput"){aE=true;if(aC.indexOf(aZ)===-1){aC.push(aZ)}}if(aZ.kind==="videoinput"){al=true;if(au.indexOf(aZ)===-1){au.push(aZ)}}Z.push(aZ);aW[aZ.deviceId+aZ.label+aZ.kind]=aZ});if(typeof ab!=="undefined"){ab.MediaDevices=Z;ab.hasMicrophone=ay;ab.hasSpeakers=aE;ab.hasWebcam=al;ab.isWebsiteHasWebcamPermissions=aQ;ab.isWebsiteHasMicrophonePermissions=at;ab.audioInputDevices=ap;ab.audioOutputDevices=aC;ab.videoInputDevices=au}if(aX){aX()}})}var ab=window.DetectRTC||{};ab.browser=ar();aq(function(aW){ab.browser.isPrivateBrowsing=!!aW});ab.browser["is"+ab.browser.name]=true;ab.osName=aT;ab.osVersion=V;var aS=typeof process==="object"&&typeof process.versions==="object"&&process.versions["node-webkit"];var aa=false;["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach(function(aW){if(aa){return}if(aW in window){aa=true}});ab.isWebRTCSupported=aa;ab.isORTCSupported=typeof RTCIceGatherer!=="undefined";var aV=false;if(ab.browser.isChrome&&ab.browser.version>=35){aV=true}else{if(ab.browser.isFirefox&&ab.browser.version>=34){aV=true}else{if(ab.browser.isEdge&&ab.browser.version>=17){aV=true}else{if(ab.osName==="Android"&&ab.browser.isChrome){aV=true}}}}if(!/^(https:|chrome-extension:)$/g.test(location.protocol||"")){var af=typeof document!=="undefined"&&typeof document.domain==="string"&&document.domain.search&&document.domain.search(/localhost|127.0./g)===-1;if(af&&(ab.browser.isChrome||ab.browser.isEdge||ab.browser.isOpera)){aV=false}else{if(ab.browser.isFirefox){aV=false}}}ab.isScreenCapturingSupported=aV;var aj={isSupported:false,isCreateMediaStreamSourceSupported:false};["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"].forEach(function(aW){if(aj.isSupported){return}if(aW in window){aj.isSupported=true;if(window[aW]&&"createMediaStreamSource" in window[aW].prototype){aj.isCreateMediaStreamSourceSupported=true}}});ab.isAudioContextSupported=aj.isSupported;ab.isCreateMediaStreamSourceSupported=aj.isCreateMediaStreamSourceSupported;var ad=false;if(ab.browser.isChrome&&ab.browser.version>31){ad=true}ab.isRtpDataChannelsSupported=ad;var T=false;if(ab.browser.isFirefox&&ab.browser.version>28){T=true}else{if(ab.browser.isChrome&&ab.browser.version>25){T=true}else{if(ab.browser.isOpera&&ab.browser.version>=11){T=true}}}ab.isSctpDataChannelsSupported=T;ab.isMobileDevice=ag;var Y=false;if(aD.getUserMedia){Y=true}else{if(aD.mediaDevices&&aD.mediaDevices.getUserMedia){Y=true}}if(ab.browser.isChrome&&ab.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")){if(typeof document!=="undefined"&&typeof document.domain==="string"&&document.domain.search&&document.domain.search(/localhost|127.0./g)===-1){Y="Requires HTTPs"}}if(ab.osName==="Nodejs"){Y=false}ab.isGetUserMediaSupported=Y;var az="";if(screen.width){var O=(screen.width)?screen.width:"";var R=(screen.height)?screen.height:"";az+=""+O+" x "+R}ab.displayResolution=az;function aP(aW,aY){function aX(a1,a0){return(a0==0)?a1:aX(a0,a1%a0)}var aZ=aX(aW,aY);return(aW/aZ)/(aY/aZ)}ab.displayAspectRatio=aP(screen.width,screen.height).toFixed(2);ab.isCanvasSupportsStreamCapturing=aK;ab.isVideoSupportsStreamCapturing=aA;if(ab.browser.name=="Chrome"&&ab.browser.version>=53){if(!ab.isCanvasSupportsStreamCapturing){ab.isCanvasSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features"}if(!ab.isVideoSupportsStreamCapturing){ab.isVideoSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features"}}ab.DetectLocalIPAddress=aB;ab.isWebSocketsSupported="WebSocket" in window&&2===window.WebSocket.CLOSING;ab.isWebSocketsBlocked=!ab.isWebSocketsSupported;if(ab.osName==="Nodejs"){ab.isWebSocketsSupported=true;ab.isWebSocketsBlocked=false}ab.checkWebSocketsSupport=function(aZ){aZ=aZ||function(){};try{var aY;var aW=new WebSocket("wss://echo.websocket.org:443/");aW.onopen=function(){ab.isWebSocketsBlocked=false;aY=(new Date).getTime();aW.send("ping")};aW.onmessage=function(){ab.WebsocketLatency=(new Date).getTime()-aY+"ms";aZ();aW.close();aW=null};aW.onerror=function(){ab.isWebSocketsBlocked=true;aZ()}}catch(aX){ab.isWebSocketsBlocked=true;aZ()}};ab.load=function(aW){aW=aW||function(){};X(aW)};if(typeof X==="function"){}if(typeof Z!=="undefined"){ab.MediaDevices=Z}else{ab.MediaDevices=[]}ab.hasMicrophone=ay;ab.hasSpeakers=aE;ab.hasWebcam=al;ab.isWebsiteHasWebcamPermissions=aQ;ab.isWebsiteHasMicrophonePermissions=at;ab.audioInputDevices=ap;ab.audioOutputDevices=aC;ab.videoInputDevices=au;var an=false;if(typeof document!=="undefined"&&typeof document.createElement==="function"&&"setSinkId" in document.createElement("video")){an=true}ab.isSetSinkIdSupported=an;var ah=false;if(ab.browser.isFirefox&&typeof mozRTCPeerConnection!=="undefined"){if("getSenders" in mozRTCPeerConnection.prototype){ah=true}}else{if(ab.browser.isChrome&&typeof webkitRTCPeerConnection!=="undefined"){if("getSenders" in webkitRTCPeerConnection.prototype){ah=true}}}ab.isRTPSenderReplaceTracksSupported=ah;var av=false;if(ab.browser.isFirefox&&ab.browser.version>38){av=true}ab.isRemoteStreamProcessingSupported=av;var am=false;if(typeof a!=="undefined"&&"applyConstraints" in a.prototype){am=true}ab.isApplyConstraintsSupported=am;var ae=false;if(ab.browser.isFirefox&&ab.browser.version>=43){ae=true}ab.isMultiMonitorScreenCapturingSupported=ae;ab.isPromisesSupported=!!("Promise" in window);ab.version="1.3.9";if(typeof ab==="undefined"){window.DetectRTC={}}var Q=window.MediaStream;if(typeof Q==="undefined"&&typeof webkitMediaStream!=="undefined"){Q=webkitMediaStream}if(typeof Q!=="undefined"&&typeof Q==="function"){ab.MediaStream=Object.keys(Q.prototype)}else{ab.MediaStream=false}if(typeof a!=="undefined"){ab.MediaStreamTrack=Object.keys(a.prototype)}else{ab.MediaStreamTrack=false}var aJ=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;if(typeof aJ!=="undefined"){ab.RTCPeerConnection=Object.keys(aJ.prototype)}else{ab.RTCPeerConnection=false}window.DetectRTC=ab;if(typeof module!=="undefined"){module.exports=ab}if(typeof define==="function"&&define.amd){define("DetectRTC",[],function(){return ab})}})();if(typeof cordova!=="undefined"){DetectRTC.isMobileDevice=true;DetectRTC.browser.name="Chrome"}if(navigator&&navigator.userAgent&&navigator.userAgent.indexOf("Crosswalk")!==-1){DetectRTC.isMobileDevice=true;DetectRTC.browser.name="Chrome"}function I(S,O,Q){if(typeof CustomEvent==="undefined"){return}var P={arguments:Q,__exposedProps__:Q};var R=new CustomEvent(O,P);S.dispatchEvent(R)}function f(P,O){if(!O.stream||!r(O.stream,"audio").length){return}if(!P||!O){throw"Both arguments are required."}if(!P.onspeaking||!P.onsilence){return}if(typeof hark==="undefined"){throw"hark.js not found."}hark(O.stream,{onspeaking:function(){P.onspeaking(O)},onsilence:function(){P.onsilence(O)},onvolumechange:function(R,Q){if(!P.onvolumechange){return}P.onvolumechange(merge({volume:R,threshold:Q},O))}})}function u(P,O){if(!O.stream||!O.stream||!O.stream.addEventListener){return}O.stream.addEventListener("mute",function(Q){Q=P.streamEvents[O.streamid];Q.session={audio:Q.muteType==="audio",video:Q.muteType==="video"};P.onmute(Q)},false);O.stream.addEventListener("unmute",function(Q){Q=P.streamEvents[O.streamid];Q.session={audio:Q.unmuteType==="audio",video:Q.unmuteType==="video"};P.onunmute(Q)},false)}function B(){if(window.crypto&&window.crypto.getRandomValues&&navigator.userAgent.indexOf("Safari")===-1){var P=window.crypto.getRandomValues(new Uint32Array(3)),R="";for(var Q=0,O=P.length;Q<O;Q++){R+=P[Q].toString(36)}return R}else{return(Math.random()*new Date().getTime()).toString(36).replace(/\./g,"")}}function n(U,V,R){if(!R.autoCreateMediaElement){V({});return}var Q=false;if(!r(U,"video").length&&!U.isVideo&&!U.isScreen){Q=true}if(DetectRTC.browser.name==="Firefox"){if(R.session.video||R.session.screen){Q=false}}var P=document.createElement(Q?"audio":"video");P.srcObject=U;P.setAttribute("autoplay",true);P.setAttribute("playsinline",true);P.setAttribute("controls",true);P.setAttribute("muted",false);P.setAttribute("volume",1);if(DetectRTC.browser.name==="Firefox"){var T="ended";if("oninactive" in P){T="inactive"}P.addEventListener(T,function(){currentUserMediaRequest.remove(U.idInstance);if(U.type==="local"){T="ended";if("oninactive" in U){T="inactive"}s.onSyncNeeded(U.streamid,T);R.attachStreams.forEach(function(Z,Y){if(U.streamid===Z.streamid){delete R.attachStreams[Y]}});var X=[];R.attachStreams.forEach(function(Y){if(Y){X.push(Y)}});R.attachStreams=X;var W=R.streamEvents[U.streamid];if(W){R.onstreamended(W);return}if(this.parentNode){this.parentNode.removeChild(this)}}},false)}var S=P.play();if(typeof S!=="undefined"){var O=false;setTimeout(function(){if(!O){O=true;V(P)}},1000);S.then(function(){if(O){return}O=true;V(P)}).catch(function(W){if(O){return}O=true;V(P)})}else{V(P)}}if(!window.addEventListener){window.addEventListener=function(Q,O,P){if(!Q.attachEvent){return}Q.attachEvent("on"+O,P)}}function q(O,P){window.removeEventListener(O,P);window.addEventListener(O,P,false)}window.attachEventListener=function(Q,P,R,O){Q.addEventListener(P,R,O)};function i(P){var O=[];P.forEach(function(Q){if(Q){O.push(Q)}});return O}function t(O){return !O.audio&&!O.video&&!O.screen&&O.data}function H(O){return typeof O==="undefined"}function m(O){return typeof O==="string"}var b=window.MediaStream;if(typeof b==="undefined"&&typeof webkitMediaStream!=="undefined"){b=webkitMediaStream}if(typeof b!=="undefined"){if(!("stop" in b.prototype)){b.prototype.stop=function(){this.getTracks().forEach(function(O){O.stop()})}}}function j(O,P){if(O.session.audio&&O.session.audio==="two-way"){return false}if(DetectRTC.browser.name==="Firefox"&&P!==false){return true}if(DetectRTC.browser.name!=="Chrome"||DetectRTC.browser.version<50){return false}if(typeof P===true){return true}if(typeof P==="undefined"&&O.session.audio&&O.session.screen&&!O.session.video){P=true;return true}return false}function N(O){if(DetectRTC.browser.name==="Firefox"){return true}if(DetectRTC.browser.name!=="Chrome"){return false}return{mandatory:{chromeMediaSource:O.mandatory.chromeMediaSource,chromeMediaSourceId:O.mandatory.chromeMediaSourceId}}}window.iOSDefaultAudioOutputDevice=window.iOSDefaultAudioOutputDevice||"speaker";function r(P,O){if(!P||!P.getTracks){return[]}return P.getTracks().filter(function(Q){return Q.kind===(O||"audio")})}function p(){var O=false;try{if(typeof RTCRtpTransceiver==="undefined"){return false}if(!("currentDirection" in RTCRtpTransceiver.prototype)){return false}var Q=new L();try{Q.addTransceiver("audio");O=true}catch(P){}Q.close()}catch(P){O=false}return O&&x()}function x(){var R=false;try{var P=new L({sdpSemantics:"unified-plan"});try{var O=P.getConfiguration();if(O.sdpSemantics=="unified-plan"){R=true}else{if(O.sdpSemantics=="plan-b"){R=false}else{R=false}}}catch(Q){R=false}}catch(Q){R=false}return R}function K(){if(typeof cordova==="undefined"||typeof cordova.plugins==="undefined"||typeof cordova.plugins.iosrtc==="undefined"){return}var O=cordova.plugins.iosrtc;window.webkitRTCPeerConnection=O.RTCPeerConnection;window.RTCSessionDescription=O.RTCSessionDescription;window.RTCIceCandidate=O.RTCIceCandidate;window.MediaStream=O.MediaStream;window.MediaStreamTrack=O.MediaStreamTrack;navigator.getUserMedia=navigator.webkitGetUserMedia=O.getUserMedia;O.debug.enable("iosrtc*");if(typeof O.selectAudioOutput=="function"){O.selectAudioOutput(window.iOSDefaultAudioOutputDevice||"speaker")}O.registerGlobals()}document.addEventListener("deviceready",K,false);K();var A={};function C(O){var P={OfferToReceiveAudio:!!O.OfferToReceiveAudio,OfferToReceiveVideo:!!O.OfferToReceiveVideo};return P}var L;if(typeof window.RTCPeerConnection!=="undefined"){L=window.RTCPeerConnection}else{if(typeof mozRTCPeerConnection!=="undefined"){L=mozRTCPeerConnection}else{if(typeof webkitRTCPeerConnection!=="undefined"){L=webkitRTCPeerConnection}}}var k=window.RTCSessionDescription||window.mozRTCSessionDescription;var h=window.RTCIceCandidate||window.mozRTCIceCandidate;var a=window.MediaStreamTrack;function o(ag){if(typeof window.RTCPeerConnection!=="undefined"){L=window.RTCPeerConnection}else{if(typeof mozRTCPeerConnection!=="undefined"){L=mozRTCPeerConnection}else{if(typeof webkitRTCPeerConnection!=="undefined"){L=webkitRTCPeerConnection}}}k=window.RTCSessionDescription||window.mozRTCSessionDescription;h=window.RTCIceCandidate||window.mozRTCIceCandidate;a=window.MediaStreamTrack;if(!L){throw"WebRTC 1.0 (RTCPeerConnection) API are NOT available in this browser."}var W=ag.rtcMultiConnection;this.extra=ag.remoteSdp?ag.remoteSdp.extra:W.extra;this.userid=ag.userid;this.streams=[];this.channels=ag.channels||[];this.connectionDescription=ag.connectionDescription;this.addStream=function(ah){W.addStream(ah,ab.userid)};this.removeStream=function(ah){W.removeStream(ah,ab.userid)};var ab=this;if(ag.remoteSdp){this.connectionDescription=ag.remoteSdp.connectionDescription}var S={};A.sdpConstraints=C({OfferToReceiveAudio:true,OfferToReceiveVideo:true});var X;var U=!!ag.renegotiatingPeer;if(ag.remoteSdp){U=!!ag.remoteSdp.renegotiatingPeer}var Y=[];W.attachStreams.forEach(function(ah){if(!!ah){Y.push(ah)}});if(!U){var O="all";if(W.candidates.turn||W.candidates.relay){if(!W.candidates.stun&&!W.candidates.reflexive&&!W.candidates.host){O="relay"}}try{var ae={iceServers:W.iceServers,iceTransportPolicy:W.iceTransportPolicy||O};if(typeof W.iceCandidatePoolSize!=="undefined"){ae.iceCandidatePoolSize=W.iceCandidatePoolSize}if(typeof W.bundlePolicy!=="undefined"){ae.bundlePolicy=W.bundlePolicy}if(typeof W.rtcpMuxPolicy!=="undefined"){ae.rtcpMuxPolicy=W.rtcpMuxPolicy}if(!!W.sdpSemantics){ae.sdpSemantics=W.sdpSemantics||"unified-plan"}if(!W.iceServers||!W.iceServers.length){ae=null;W.optionalArgument=null}X=new L(ae,W.optionalArgument)}catch(ad){try{var ae={iceServers:W.iceServers};X=new L(ae)}catch(ad){X=new L()}}}else{X=ag.peerRef}if(!X.getRemoteStreams&&X.getReceivers){X.getRemoteStreams=function(){var ah=new b();X.getReceivers().forEach(function(ai){ah.addTrack(ai.track)});return[ah]}}if(!X.getLocalStreams&&X.getSenders){X.getLocalStreams=function(){var ah=new b();X.getSenders().forEach(function(ai){ah.addTrack(ai.track)});return[ah]}}X.onicecandidate=function(ai){if(!ai.candidate){if(!W.trickleIce){var ah=X.localDescription;ag.onLocalSdp({type:ah.type,sdp:ah.sdp,remotePeerSdpConstraints:ag.remotePeerSdpConstraints||false,renegotiatingPeer:!!ag.renegotiatingPeer||false,connectionDescription:ab.connectionDescription,dontGetRemoteStream:!!ag.dontGetRemoteStream,extra:W?W.extra:{},streamsToShare:aa})}return}if(!W.trickleIce){return}ag.onLocalCandidate({candidate:ai.candidate.candidate,sdpMid:ai.candidate.sdpMid,sdpMLineIndex:ai.candidate.sdpMLineIndex})};Y.forEach(function(ah){if(ag.remoteSdp&&ag.remoteSdp.remotePeerSdpConstraints&&ag.remoteSdp.remotePeerSdpConstraints.dontGetRemoteStream){return}if(ag.dontAttachLocalStream){return}ah=W.beforeAddingStream(ah,ab);if(!ah){return}X.getLocalStreams().forEach(function(ai){if(ah&&ai.id==ah.id){ah=null}});if(ah&&ah.getTracks){ah.getTracks().forEach(function(ai){try{X.addTrack(ai,ah)}catch(aj){}})}});X.oniceconnectionstatechange=X.onsignalingstatechange=function(){if(ab.signalingState!="stable"){console.log("Negotiation skipped in stable");return}var ah=ab.extra;if(W.peers[ab.userid]){ah=W.peers[ab.userid].extra||ah}if(!X){return}ag.onPeerStateChanged({iceConnectionState:X.iceConnectionState,iceGatheringState:X.iceGatheringState,signalingState:X.signalingState,extra:ah,userid:ab.userid});if(X&&X.iceConnectionState&&X.iceConnectionState.search(/closed|failed/gi)!==-1&&ab.streams instanceof Array){ab.streams.forEach(function(aj){var ai=W.streamEvents[aj.id]||{streamid:aj.id,stream:aj,type:"remote"};W.onstreamended(ai)})}};var Z={OfferToReceiveAudio:!!Y.length,OfferToReceiveVideo:!!Y.length};if(ag.localPeerSdpConstraints){Z=ag.localPeerSdpConstraints}A.sdpConstraints=C(Z);var af;var P={};X.ontrack=function(ai){if(!ai||ai.type!=="track"){return}ai.stream=ai.streams[ai.streams.length-1];if(!ai.stream.id){ai.stream.id=ai.track.id}if(P[ai.stream.id]&&DetectRTC.browser.name!=="Safari"){if(ai.track){ai.track.onended=function(){X&&X.onremovestream(ai)}}return}P[ai.stream.id]=ai.stream.id;var ah={};if(ag.remoteSdp&&ag.remoteSdp.streamsToShare){ah=ag.remoteSdp.streamsToShare}else{if(ag.streamsToShare){ah=ag.streamsToShare}}var aj=ah[ai.stream.id];if(aj){ai.stream.isAudio=aj.isAudio;ai.stream.isVideo=aj.isVideo;ai.stream.isScreen=aj.isScreen}else{ai.stream.isVideo=!!r(ai.stream,"video").length;ai.stream.isAudio=!ai.stream.isVideo;ai.stream.isScreen=false}ai.stream.streamid=ai.stream.id;S[ai.stream.id]=ai.stream;ag.onRemoteStream(ai.stream);ai.stream.getTracks().forEach(function(ak){ak.onended=function(){X&&X.onremovestream(ai)}});ai.stream.onremovetrack=function(){X&&X.onremovestream(ai)}};X.onremovestream=function(ah){ah.stream.streamid=ah.stream.id;if(S[ah.stream.id]){delete S[ah.stream.id]}ag.onRemoteStreamRemoved(ah.stream)};if(typeof X.removeStream!=="function"){X.removeStream=function(ah){ah.getTracks().forEach(function(ai){X.removeTrack(ai,ah)})}}this.addRemoteCandidate=function(ah){X.addIceCandidate(new h(ah))};function R(ai,ah){ah=ah||function(){};if(DetectRTC.browser.name!=="Safari"){ai.sdp=W.processSdp(ai.sdp)}X.setRemoteDescription(new k(ai),ah,function(aj){if(!!W.enableLogs){console.error("setRemoteDescription failed","\n",aj,"\n",ai.sdp)}ah()})}this.addRemoteSdp=function(ai,ah){ah=ah||function(){};if(DetectRTC.browser.name!=="Safari"){ai.sdp=W.processSdp(ai.sdp)}X.setRemoteDescription(new k(ai)).then(ah,function(aj){if(!!W.enableLogs){console.error("setRemoteDescription failed","\n",aj,"\n",ai.sdp)}ah()}).catch(function(aj){if(!!W.enableLogs){console.error("setRemoteDescription failed","\n",aj,"\n",ai.sdp)}ah()})};var T=true;if(ag.remoteSdp){T=false}this.createDataChannel=function(){var ah=X.createDataChannel("sctp",{});ac(ah)};if(W.session.data===true&&!U){if(!T){X.ondatachannel=function(ai){var ah=ai.channel;ac(ah)}}else{this.createDataChannel()}}this.enableDisableVideoEncoding=function(ah){var ai;X.getSenders().forEach(function(ak){if(!ai&&ak.track.kind==="video"){ai=ak}});if(!ai||!ai.getParameters){return}var aj=ai.getParameters();aj.encodings[1]&&(aj.encodings[1].active=!!ah);aj.encodings[2]&&(aj.encodings[2].active=!!ah);ai.setParameters(aj)};if(ag.remoteSdp){if(ag.remoteSdp.remotePeerSdpConstraints){Z=ag.remoteSdp.remotePeerSdpConstraints}A.sdpConstraints=C(Z);this.addRemoteSdp(ag.remoteSdp,function(){V("createAnswer")})}function ac(ah){ah.binaryType="arraybuffer";ah.onmessage=function(ai){ag.onDataChannelMessage(ai.data)};ah.onopen=function(){ag.onDataChannelOpened(ah)};ah.onerror=function(ai){ag.onDataChannelError(ai)};ah.onclose=function(ai){ag.onDataChannelClosed(ai)};ah.internalSend=ah.send;ah.send=function(ai){if(ah.readyState!=="open"){return}ah.internalSend(ai)};X.channel=ah}if(W.session.audio=="two-way"||W.session.video=="two-way"||W.session.screen=="two-way"){A.sdpConstraints=C({OfferToReceiveAudio:W.session.audio=="two-way"||(ag.remoteSdp&&ag.remoteSdp.remotePeerSdpConstraints&&ag.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio),OfferToReceiveVideo:W.session.video=="two-way"||W.session.screen=="two-way"||(ag.remoteSdp&&ag.remoteSdp.remotePeerSdpConstraints&&ag.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio)})}var aa={};X.getLocalStreams().forEach(function(ah){aa[ah.streamid]={isAudio:!!ah.isAudio,isVideo:!!ah.isVideo,isScreen:!!ah.isScreen}});function Q(ah){X[ah](function(ai){if(DetectRTC.browser.name!=="Safari"){ai.sdp=W.processSdp(ai.sdp)}X.setLocalDescription(ai,function(){if(!W.trickleIce){return}ag.onLocalSdp({type:ai.type,sdp:ai.sdp,remotePeerSdpConstraints:ag.remotePeerSdpConstraints||false,renegotiatingPeer:!!ag.renegotiatingPeer||false,connectionDescription:ab.connectionDescription,dontGetRemoteStream:!!ag.dontGetRemoteStream,extra:W?W.extra:{},streamsToShare:aa});W.onSettingLocalDescription(ab)},function(aj){if(!!W.enableLogs){console.error("setLocalDescription-error",aj)}})},function(ai){if(!!W.enableLogs){console.error("sdp-"+ah+"-error",ai)}},A.sdpConstraints)}function V(ah){X[ah](A.sdpConstraints).then(function(ai){if(DetectRTC.browser.name!=="Safari"){ai.sdp=W.processSdp(ai.sdp)}X.setLocalDescription(ai).then(function(){if(!W.trickleIce){return}ag.onLocalSdp({type:ai.type,sdp:ai.sdp,remotePeerSdpConstraints:ag.remotePeerSdpConstraints||false,renegotiatingPeer:!!ag.renegotiatingPeer||false,connectionDescription:ab.connectionDescription,dontGetRemoteStream:!!ag.dontGetRemoteStream,extra:W?W.extra:{},streamsToShare:aa});W.onSettingLocalDescription(ab)},function(aj){if(!W.enableLogs){return}console.error("setLocalDescription error",aj)})},function(ai){if(!!W.enableLogs){console.error("sdp-error",ai)}})}if(T){V("createOffer")}X.nativeClose=X.close;X.close=function(){if(!X){return}try{if(X.nativeClose!==X.close){X.nativeClose()}}catch(ah){}X=null;ab.peer=null};this.peer=X}var e=(function(){function O(ac,ae){var ad=V(ac);if(!ad.videoCodecNumbers){return ac}if(ae==="vp8"&&ad.vp8LineNumber===ad.videoCodecNumbers[0]){return ac}if(ae==="vp9"&&ad.vp9LineNumber===ad.videoCodecNumbers[0]){return ac}if(ae==="h264"&&ad.h264LineNumber===ad.videoCodecNumbers[0]){return ac}ac=Y(ac,ae,ad);return ac}function Y(ad,ae,af,ai){var ag="";if(ae==="vp8"){if(!af.vp8LineNumber){return ad}ag=af.vp8LineNumber}if(ae==="vp9"){if(!af.vp9LineNumber){return ad}ag=af.vp9LineNumber}if(ae==="h264"){if(!af.h264LineNumber){return ad}ag=af.h264LineNumber}var ah=af.videoCodecNumbersOriginal.split("SAVPF")[0]+"SAVPF ";var ac=[ag];if(ai){ac=[]}af.videoCodecNumbers.forEach(function(aj){if(aj===ag){return}ac.push(aj)});ah+=ac.join(" ");ad=ad.replace(af.videoCodecNumbersOriginal,ah);return ad}function V(ac){var ad={};ac.split("\n").forEach(function(ae){if(ae.indexOf("m=video")===0){ad.videoCodecNumbers=[];ae.split("SAVPF")[1].split(" ").forEach(function(af){af=af.trim();if(!af||!af.length){return}ad.videoCodecNumbers.push(af);ad.videoCodecNumbersOriginal=ae})}if(ae.indexOf("VP8/90000")!==-1&&!ad.vp8LineNumber){ad.vp8LineNumber=ae.replace("a=rtpmap:","").split(" ")[0]}if(ae.indexOf("VP9/90000")!==-1&&!ad.vp9LineNumber){ad.vp9LineNumber=ae.replace("a=rtpmap:","").split(" ")[0]}if(ae.indexOf("H264/90000")!==-1&&!ad.h264LineNumber){ad.h264LineNumber=ae.replace("a=rtpmap:","").split(" ")[0]}});return ad}function Z(ac){var ad=V(ac);ac=Y(ac,"vp9",ad,true);ac=Y(ac,"vp8",ad,true);return ac}function ab(ac){if(!ac||typeof ac!=="string"){throw"Invalid arguments."}ac=ac.replace("a=rtcp-fb:126 nack\r\n","");ac=ac.replace("a=rtcp-fb:126 nack pli\r\n","a=rtcp-fb:126 pli\r\n");ac=ac.replace("a=rtcp-fb:97 nack\r\n","");ac=ac.replace("a=rtcp-fb:97 nack pli\r\n","a=rtcp-fb:97 pli\r\n");return ac}function R(ad,ac){if(!ac||!ac.getSenders||!ac.getSenders().length){return}if(!ad||typeof ad!=="string"){throw"Invalid arguments."}ac.getSenders().forEach(function(af){var ag=af.getParameters();for(var ae=0;ae<ag.codecs.length;ae++){if(ag.codecs[ae].mimeType==ad){ag.codecs.unshift(ag.codecs.splice(ae,1));break}}af.setParameters(ag)})}function U(ac){return ac.replace(/m=audio ([0-9]+) RTP\/SAVPF ([0-9 ]*)/g,"m=audio $1 RTP/SAVPF 9")}function S(ac,ad,ae){if(!ad){return ac}if(typeof isFirefox!=="undefined"&&isFirefox){return ac}if(ae){if(!ad.screen){console.warn("It seems that you are not using bandwidth for screen. Screen sharing is expected to fail.")}else{if(ad.screen<300){console.warn("It seems that you are using wrong bandwidth value for screen. Screen sharing is expected to fail.")}}}if(ad.screen&&ae){ac=ac.replace(/b=AS([^\r\n]+\r\n)/g,"");ac=ac.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+ad.screen+"\r\n")}if(ad.audio||ad.video){ac=ac.replace(/b=AS([^\r\n]+\r\n)/g,"")}if(ad.audio){ac=ac.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+ad.audio+"\r\n")}if(ad.screen){ac=ac.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+ad.screen+"\r\n")}else{if(ad.video){ac=ac.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+ad.video+"\r\n")}}return ac}function aa(ac,ae,ad){return W(ac,0,-1,ae,ad)}function W(ad,ai,af,ah,ag){var ae=af!==-1?af:ad.length;for(var ac=ai;ac<ae;++ac){if(ad[ac].indexOf(ah)===0){if(!ag||ad[ac].toLowerCase().indexOf(ag.toLowerCase())!==-1){return ac}}}return null}function P(ad){var ae=new RegExp("a=rtpmap:(\\d+) \\w+\\/\\d+");var ac=ad.match(ae);return(ac&&ac.length===2)?ac[1]:null}function X(ae,ad){ad=ad||{};var ag=ad.min;var al=ad.max;var aj=ae.split("\r\n");var am=aa(aj,"a=rtpmap","VP8/90000");var ac;if(am){ac=P(aj[am])}if(!ac){return ae}var ah=aa(aj,"a=rtpmap","rtx/90000");var ak;if(ah){ak=P(aj[ah])}if(!ah){return ae}var ai=aa(aj,"a=fmtp:"+ak.toString());if(ai!==null){var af="\r\n";af+="a=fmtp:"+ac+" x-google-min-bitrate="+(ag||"228")+"; x-google-max-bitrate="+(al||"228");aj[ai]=aj[ai].concat(af);ae=aj.join("\r\n")}return ae}function Q(ad,ah){ah=ah||{};var ag=ad.split("\r\n");var ai=aa(ag,"a=rtpmap","opus/48000");var af;if(ai){af=P(ag[ai])}if(!af){return ad}var ac=aa(ag,"a=fmtp:"+af.toString());if(ac===null){return ad}var ae="";ae+="; stereo="+(typeof ah.stereo!="undefined"?ah.stereo:"1");ae+="; sprop-stereo="+(typeof ah["sprop-stereo"]!="undefined"?ah["sprop-stereo"]:"1");if(typeof ah.maxaveragebitrate!="undefined"){ae+="; maxaveragebitrate="+(ah.maxaveragebitrate||128*1024*8)}if(typeof ah.maxplaybackrate!="undefined"){ae+="; maxplaybackrate="+(ah.maxplaybackrate||128*1024*8)}if(typeof ah.cbr!="undefined"){ae+="; cbr="+(typeof ah.cbr!="undefined"?ah.cbr:"1")}if(typeof ah.useinbandfec!="undefined"){ae+="; useinbandfec="+ah.useinbandfec}if(typeof ah.usedtx!="undefined"){ae+="; usedtx="+ah.usedtx}if(typeof ah.maxptime!="undefined"){ae+="\r\na=maxptime:"+ah.maxptime}ag[ac]=ag[ac].concat(ae);ad=ag.join("\r\n");return ad}function T(ac){var ag=ac.split("\r\n");var af=null;for(var ae=0;ae<ag.length;ae++){if(ag[ae].search("opus/48000")!==-1){var ad=extractSdp(ag[ae],/:(\d+) opus\/48000/i);break}}for(var ae=0;ae<ag.length;ae++){if(ag[ae].search("a=fmtp")!==-1){var ah=extractSdp(ag[ae],/a=fmtp:(\d+)/);if(ah===ad){af=ae;break}}}if(af===null){return ac}ag[af]=ag[af].concat("; stereo=1; sprop-stereo=1");ac=ag.join("\r\n");return ac}return{removeVPX:Z,disableNACK:ab,prioritize:R,removeNonG722:U,setApplicationSpecificBandwidth:function(ac,ad,ae){return S(ac,ad,ae)},setVideoBitrates:function(ac,ad){return X(ac,ad)},setOpusAttributes:function(ac,ad){return Q(ac,ad)},preferVP9:function(ac){return O(ac,"vp9")},preferCodec:O,forceStereoAudio:T}})();window.BandwidthHandler=e;var z=(function(){function O(P,T){var R=T.candidate;var V=P.candidates;var S=V.stun;var Q=V.turn;if(!H(V.reflexive)){S=V.reflexive}if(!H(V.relay)){Q=V.relay}if(!V.host&&!!R.match(/typ host/g)){return}if(!Q&&!!R.match(/typ relay/g)){return}if(!S&&!!R.match(/typ srflx/g)){return}var U=P.iceProtocols;if(!U.udp&&!!R.match(/ udp /g)){return}if(!U.tcp&&!!R.match(/ tcp /g)){return}if(P.enableLogs){console.debug("Your candidate pairs:",R)}return{candidate:R,sdpMid:T.sdpMid,sdpMLineIndex:T.sdpMLineIndex}}return{processCandidates:O}})();var G=(function(){function O(P){var Q=[{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun.l.google.com:19302?transport=udp"]}];return Q}return{getIceServers:O}})();function y(P,O){if(P.mandatory&&P.mandatory.chromeMediaSource){O.isScreen=true}else{if(P.mozMediaSource||P.mediaSource){O.isScreen=true}else{if(P.video){O.isVideo=true}else{if(P.audio){O.isAudio=true}}}}}window.currentUserMediaRequest={streams:[],mutex:false,queueRequests:[],remove:function(P){this.mutex=false;var Q=this.streams[P];if(!Q){return}Q=Q.stream;var O=Q.currentUserMediaRequestOptions;if(this.queueRequests.indexOf(O)){delete this.queueRequests[this.queueRequests.indexOf(O)];this.queueRequests=i(this.queueRequests)}this.streams[P].stream=null;delete this.streams[P]}};function M(O){if(currentUserMediaRequest.mutex===true){currentUserMediaRequest.queueRequests.push(O);return}currentUserMediaRequest.mutex=true;var T=JSON.stringify(O.localMediaConstraints);function S(Y,W){y(O.localMediaConstraints,Y);var X="ended";if("oninactive" in Y){X="inactive"}Y.addEventListener(X,function(){delete currentUserMediaRequest.streams[T];currentUserMediaRequest.mutex=false;if(currentUserMediaRequest.queueRequests.indexOf(O)){delete currentUserMediaRequest.queueRequests[currentUserMediaRequest.queueRequests.indexOf(O)];currentUserMediaRequest.queueRequests=i(currentUserMediaRequest.queueRequests)}},false);currentUserMediaRequest.streams[T]={stream:Y};currentUserMediaRequest.mutex=false;if(currentUserMediaRequest.queueRequests.length){M(currentUserMediaRequest.queueRequests.shift())}O.onGettingLocalMedia(Y,W)}if(currentUserMediaRequest.streams[T]){S(currentUserMediaRequest.streams[T].stream,true)}else{var R=!!(/BB10|BlackBerry/i.test(navigator.userAgent||""));if(R||typeof navigator.mediaDevices==="undefined"||typeof navigator.mediaDevices.getUserMedia!=="function"){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;navigator.getUserMedia(O.localMediaConstraints,function(W){W.streamid=W.streamid||W.id||B();W.idInstance=T;S(W)},function(W){O.onLocalMediaError(W,O.localMediaConstraints)});return}if(typeof navigator.mediaDevices==="undefined"){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;var Q=function(){};var V=function(){};var U,P;navigator.mediaDevices={getUserMedia:function(W){navigator.getUserMedia(W,function(X){X(stream);U=stream},function(X){V(X);P=X});return{then:function(X){if(U){X(U);return}Q=X;return{then:function(Y){if(P){Y(P);return}V=Y}}}}}}}if(O.localMediaConstraints.isScreen===true){if(navigator.mediaDevices.getDisplayMedia){navigator.mediaDevices.getDisplayMedia(O.localMediaConstraints).then(function(W){W.streamid=W.streamid||W.id||B();W.idInstance=T;S(W)}).catch(function(W){O.onLocalMediaError(W,O.localMediaConstraints)})}else{if(navigator.getDisplayMedia){navigator.getDisplayMedia(O.localMediaConstraints).then(function(W){W.streamid=W.streamid||W.id||B();W.idInstance=T;S(W)}).catch(function(W){O.onLocalMediaError(W,O.localMediaConstraints)})}else{throw new Error("getDisplayMedia API is not availabe in this browser.")}}return}navigator.mediaDevices.getUserMedia(O.localMediaConstraints).then(function(W){W.streamid=W.streamid||W.id||B();W.idInstance=T;S(W)}).catch(function(W){O.onLocalMediaError(W,O.localMediaConstraints)})}}var s=(function(){function P(R){if(!R){return}if(typeof R==="string"||typeof R==="undefined"){return R}if(R.audio&&R.video){return null}if(R.audio){return"audio"}if(R.video){return"video"}return}function O(V,R,S){if(!V||!V.addEventListener){return}if(typeof R=="undefined"||R==true){var U="ended";if("oninactive" in V){U="inactive"}V.addEventListener(U,function(){s.onSyncNeeded(this.streamid,U)},false)}V.mute=function(W,X){W=P(W);if(typeof X!=="undefined"){R=X}if(typeof W=="undefined"||W=="audio"){r(V,"audio").forEach(function(Y){Y.enabled=false;S.streamEvents[V.streamid].isAudioMuted=true})}if(typeof W=="undefined"||W=="video"){r(V,"video").forEach(function(Y){Y.enabled=false})}if(typeof R=="undefined"||R==true){s.onSyncNeeded(V.streamid,"mute",W)}S.streamEvents[V.streamid].muteType=W||"both";I(V,"mute",W)};V.unmute=function(W,Y){W=P(W);if(typeof Y!=="undefined"){R=Y}T();if(typeof W=="undefined"||W=="audio"){r(V,"audio").forEach(function(Z){Z.enabled=true;S.streamEvents[V.streamid].isAudioMuted=false})}if(typeof W=="undefined"||W=="video"){r(V,"video").forEach(function(Z){Z.enabled=true});if(typeof W!=="undefined"&&W=="video"&&S.streamEvents[V.streamid].isAudioMuted){(function X(Z){if(!Z){Z=0}Z++;if(Z<100&&S.streamEvents[V.streamid].isAudioMuted){V.mute("audio");setTimeout(function(){X(Z)},50)}})()}}if(typeof R=="undefined"||R==true){s.onSyncNeeded(V.streamid,"unmute",W)}S.streamEvents[V.streamid].unmuteType=W||"both";I(V,"unmute",W)};function T(){if(!S.streamEvents[V.streamid].mediaElement){return}var W=S.streamEvents[V.streamid].mediaElement;W.volume=0;Q(200,5,function(){try{W.volume+=0.2}catch(X){W.volume=1}})}}function Q(U,S,T,R){R=(R||0)+1;if(R>=S){return}setTimeout(function(){T();Q(U,S,T,R)},U)}return{setHandlers:O,onSyncNeeded:function(S,T,R){}}})();function d(O){var P={};function Q(X,T,R){var U=X.uuid;if(!P[U]){P[U]=[]}P[U].push(X.message);if(X.last){var V=P[U].join("");if(X.isobject){V=JSON.parse(V)}var S=new Date().getTime();var W=S-X.sendingTime;var Y={data:V,userid:T,extra:R,latency:W};if(O.autoTranslateText){Y.original=Y.data;O.Translator.TranslateText(Y.data,function(Z){Y.data=Z;O.onmessage(Y)})}else{O.onmessage(Y)}delete P[U]}}return{receive:Q}}var D={send:function(R){var Q=R.connection;var V=R.channel,P=R.remoteUserId,X=R.text,U=Q.chunkSize||1000,W="",Y=false;if(!m(X)){Y=true;X=JSON.stringify(X)}var O=B();var T=new Date().getTime();S(X);function S(Z,ab){var aa={type:"text",uuid:O,sendingTime:T};if(Z){ab=Z;aa.packets=parseInt(ab.length/U)}if(ab.length>U){aa.message=ab.slice(0,U)}else{aa.message=ab;aa.last=true;aa.isobject=Y}V.send(aa,P);W=ab.slice(aa.message.length);if(W.length){setTimeout(function(){S(null,W)},Q.chunkInterval||100)}}}};var F=(function(){function O(P){var R={};P.onFileStart=function(S){var T=document.createElement("div");T.title=S.name;T.innerHTML="<label>0%</label> <progress></progress>";if(S.remoteUserId){T.innerHTML+=" (Sharing with:"+S.remoteUserId+")"}if(!P.filesContainer){P.filesContainer=document.body||document.documentElement}P.filesContainer.insertBefore(T,P.filesContainer.firstChild);if(!S.remoteUserId){R[S.uuid]={div:T,progress:T.querySelector("progress"),label:T.querySelector("label")};R[S.uuid].progress.max=S.maxChunks;return}if(!R[S.uuid]){R[S.uuid]={}}R[S.uuid][S.remoteUserId]={div:T,progress:T.querySelector("progress"),label:T.querySelector("label")};R[S.uuid][S.remoteUserId].progress.max=S.maxChunks};P.onFileProgress=function(S){var T=R[S.uuid];if(!T){return}if(S.remoteUserId){T=R[S.uuid][S.remoteUserId];if(!T){return}}T.progress.value=S.currentPosition||S.maxChunks||T.progress.max;Q(T.progress,T.label)};P.onFileEnd=function(S){var T=R[S.uuid];if(!T){console.error("No such progress-helper element exist.",S);return}if(S.remoteUserId){T=R[S.uuid][S.remoteUserId];if(!T){return}}var U=T.div;if(S.type.indexOf("image")!=-1){U.innerHTML='<a href="'+S.url+'" download="'+S.name+'">Download <strong style="color:red;">'+S.name+'</strong> </a><br /><img src="'+S.url+'" title="'+S.name+'" style="max-width: 80%;">'}else{U.innerHTML='<a href="'+S.url+'" download="'+S.name+'">Download <strong style="color:red;">'+S.name+'</strong> </a><br /><iframe src="'+S.url+'" title="'+S.name+'" style="width: 80%;border: 0;height: inherit;margin-top:1em;"></iframe>'}};function Q(U,T){if(U.position===-1){return}var S=+U.position.toFixed(2).split(".")[1]||100;T.innerHTML=S+"%"}}return{handle:O}})();var J=(function(){function O(P){P.autoTranslateText=false;P.language="en";P.googKey="AIzaSyCgB5hmFY74WYB-EoWkhr9cAGr6TiTHrEE";P.Translator={TranslateText:function(U,V){var Q=document.createElement("script");Q.type="text/javascript";var T=encodeURIComponent(U);var R="method"+P.token();window[R]=function(W){if(W.data&&W.data.translations[0]&&V){V(W.data.translations[0].translatedText);return}if(W.error&&W.error.message==="Daily Limit Exceeded"){console.error('Text translation failed. Error message: "Daily Limit Exceeded."');return}if(W.error){console.error(W.error.message);return}console.error(W)};var S="https://www.googleapis.com/language/translate/v2?key="+P.googKey+"&target="+(P.language||"en-US")+"&callback=window."+R+"&q="+T;Q.src=S;document.getElementsByTagName("head")[0].appendChild(Q)},getListOfLanguages:function(S){var R=new XMLHttpRequest();R.onreadystatechange=function(){if(R.readyState==XMLHttpRequest.DONE){var T=JSON.parse(R.responseText);if(T&&T.data&&T.data.languages){S(T.data.languages);return}if(T.error&&T.error.message==="Daily Limit Exceeded"){console.error('Text translation failed. Error message: "Daily Limit Exceeded."');return}if(T.error){console.error(T.error.message);return}console.error(T)}};var Q="https://www.googleapis.com/language/translate/v2/languages?key="+P.googKey+"&target=en";R.open("GET",Q,true);R.send(null)}}}return{handle:O}})();(function(P){w=w||{useDefaultDevices:true};P.channel=P.sessionid=(c||location.href.replace(/\/|:|#|\?|\$|\^|%|\.|`|~|!|\+|@|\[|\||]|\|*. /g,"").split("\n").join("").split("\r").join(""))+"";var T=new l(P);var Y={};T.onGettingLocalMedia=function(ac,ad){ad=ad||function(){};if(Y[ac.streamid]){ad();return}Y[ac.streamid]=true;try{ac.type="local"}catch(ab){}P.setStreamEndHandler(ac);n(ac,function(ae){ae.id=ac.streamid;ae.muted=true;ae.volume=0;if(P.attachStreams.indexOf(ac)===-1){P.attachStreams.push(ac)}if(typeof s!=="undefined"){s.setHandlers(ac,true,P)}P.streamEvents[ac.streamid]={stream:ac,type:"local",mediaElement:ae,userid:P.userid,extra:P.extra,streamid:ac.streamid,isAudioMuted:true};try{f(P,P.streamEvents[ac.streamid]);u(P,P.streamEvents[ac.streamid]);P.onstream(P.streamEvents[ac.streamid])}catch(af){}ad()},P)};T.onGettingRemoteMedia=function(ad,ac){try{ad.type="remote"}catch(ab){}P.setStreamEndHandler(ad,"remote-stream");n(ad,function(ae){ae.id=ad.streamid;if(typeof s!=="undefined"){s.setHandlers(ad,false,P)}P.streamEvents[ad.streamid]={stream:ad,type:"remote",userid:ac,extra:P.peers[ac]?P.peers[ac].extra:{},mediaElement:ae,streamid:ad.streamid};u(P,P.streamEvents[ad.streamid]);P.onstream(P.streamEvents[ad.streamid])},P)};T.onRemovingRemoteMedia=function(ad,ac){var ab=P.streamEvents[ad.streamid];if(!ab){ab={stream:ad,type:"remote",userid:ac,extra:P.peers[ac]?P.peers[ac].extra:{},streamid:ad.streamid,mediaElement:P.streamEvents[ad.streamid]?P.streamEvents[ad.streamid].mediaElement:null}}if(P.peersBackup[ab.userid]){ab.extra=P.peersBackup[ab.userid].extra}P.onstreamended(ab);delete P.streamEvents[ad.streamid]};T.onNegotiationNeeded=function(ac,ad,ae){ae=ae||function(){};ad=ad||ac.remoteUserId;ac=ac||"";var ab={remoteUserId:ad,message:ac,sender:P.userid};if(ac.remoteUserId&&ac.message&&ac.sender){ab=ac}R(function(){P.socket.emit(P.socketMessageEvent,ab,ae)})};function O(ab){P.deletePeer(ab)}T.onUserLeft=O;T.disconnectWith=function(ab,ac){if(P.socket){P.socket.emit("disconnect-with",ab,ac||function(){})}P.deletePeer(ab)};P.socketOptions={transport:"polling"};function R(ab){P.socketAutoReConnect=true;if(P.socket){if(ab){ab(P.socket)}return}if(typeof g==="undefined"){if(typeof FirebaseConnection!=="undefined"){window.SocketConnection=FirebaseConnection}else{if(typeof PubNubConnection!=="undefined"){window.SocketConnection=PubNubConnection}else{throw"SocketConnection.js seems missed."}}}new g(P,function(ac){if(ab){ab(P.socket)}})}P.openOrJoin=function(ab,ac){ac=ac||function(){};P.checkPresence(ab,function(af,ag){if(af){P.sessionid=ag;var ah=false;var ad=false;var ae=!!P.session.oneway;var aj=t(P.session);ad={OfferToReceiveAudio:P.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:P.sdpConstraints.mandatory.OfferToReceiveVideo};ah={OfferToReceiveAudio:ae?!!P.session.audio:P.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:ae?!!P.session.video||!!P.session.screen:P.sdpConstraints.mandatory.OfferToReceiveVideo};var ai={remoteUserId:P.sessionid,message:{newParticipationRequest:true,isOneWay:ae,isDataOnly:aj,localPeerSdpConstraints:ah,remotePeerSdpConstraints:ad},sender:P.userid};W(ai.message,function(){Q(ai,ac)});return}P.waitingForLocalMedia=true;P.isInitiator=true;P.sessionid=ag||P.sessionid;if(t(P.session)){V(ac);return}P.captureUserMedia(function(){V(ac)})})};P.waitingForLocalMedia=false;P.open=function(ab,ac){ac=ac||function(){};P.waitingForLocalMedia=true;P.isInitiator=true;P.sessionid=ab||P.sessionid;R(function(){if(t(P.session)){V(ac);return}P.captureUserMedia(function(){V(ac)})})};P.peersBackup={};P.deletePeer=function(ae){if(!ae||!P.peers[ae]){return}var ab={userid:ae,extra:P.peers[ae]?P.peers[ae].extra:{}};if(P.peersBackup[ab.userid]){ab.extra=P.peersBackup[ab.userid].extra}P.onleave(ab);if(!!P.peers[ae]){P.peers[ae].streams.forEach(function(af){af.stop()});var ac=P.peers[ae].peer;if(ac&&ac.iceConnectionState!=="closed"){try{ac.close()}catch(ad){}}if(P.peers[ae]){P.peers[ae].peer=null;delete P.peers[ae]}}};P.rejoin=function(ac){if(P.isInitiator||!ac||!Object.keys(ac).length){return}var ab={};if(P.peers[ac.remoteUserId]){ab=P.peers[ac.remoteUserId].extra;P.deletePeer(ac.remoteUserId)}if(ac&&ac.remoteUserId){P.join(ac.remoteUserId);P.onReConnecting({userid:ac.remoteUserId,extra:ab})}};P.join=function(ab,aj){P.sessionid=(ab?ab.sessionid||ab.remoteUserId||ab:false)||P.sessionid;P.sessionid+="";var ae=false;var ah=false;var af=false;var ai=false;if((ab&&ab.session)||!ab||typeof ab==="string"){var ag=ab?ab.session||P.session:P.session;af=!!ag.oneway;ai=t(ag);ah={OfferToReceiveAudio:P.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:P.sdpConstraints.mandatory.OfferToReceiveVideo};ae={OfferToReceiveAudio:af?!!P.session.audio:P.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:af?!!P.session.video||!!P.session.screen:P.sdpConstraints.mandatory.OfferToReceiveVideo}}aj=aj||{};var ad=function(){};if(typeof aj==="function"){ad=aj;aj={}}if(typeof aj.localPeerSdpConstraints!=="undefined"){ae=aj.localPeerSdpConstraints}if(typeof aj.remotePeerSdpConstraints!=="undefined"){ah=aj.remotePeerSdpConstraints}if(typeof aj.isOneWay!=="undefined"){af=aj.isOneWay}if(typeof aj.isDataOnly!=="undefined"){ai=aj.isDataOnly}var ac={remoteUserId:P.sessionid,message:{newParticipationRequest:true,isOneWay:af,isDataOnly:ai,localPeerSdpConstraints:ae,remotePeerSdpConstraints:ah},sender:P.userid};W(ac.message,function(){R(function(){Q(ac,ad)})});return ac};function Q(ac,ab){P.socket.emit("join-room",{sessionid:P.sessionid,session:P.session,mediaConstraints:P.mediaConstraints,sdpConstraints:P.sdpConstraints,streams:U(),extra:P.extra,password:typeof P.password!=="undefined"&&typeof P.password!=="object"?P.password:""},function(ad,ae){if(ad===true){if(P.enableLogs){console.log("isRoomJoined: ",ad," roomid: ",P.sessionid)}if(!!P.peers[P.sessionid]){return}T.onNegotiationNeeded(ac)}if(ad===false){if(P.enableLogs){console.warn("isRoomJoined: ",ae," roomid: ",P.sessionid)}false&&setTimeout(function(){Q(ac,ab)},3000)}ab(ad,P.sessionid,ae)})}P.publicRoomIdentifier="";function V(ab){if(P.enableLogs){console.log("Sending open-room signal to socket.io")}P.waitingForLocalMedia=false;P.socket.emit("open-room",{sessionid:P.sessionid,session:P.session,mediaConstraints:P.mediaConstraints,sdpConstraints:P.sdpConstraints,streams:U(),extra:P.extra,identifier:P.publicRoomIdentifier,password:typeof P.password!=="undefined"&&typeof P.password!=="object"?P.password:""},function(ac,ad){if(ac===true){if(P.enableLogs){console.log("isRoomOpened: ",ac," roomid: ",P.sessionid)}ab(ac,P.sessionid)}if(ac===false){if(P.enableLogs){console.warn("isRoomOpened: ",ad," roomid: ",P.sessionid)}ab(ac,P.sessionid,ad)}})}function U(){try{return P.streamEvents.selectAll("local").map(function(ac){return{streamid:ac.streamid,tracks:ac.stream.getTracks().length}})}catch(ab){return[]}}function W(ac,ae){if(P.dontCaptureUserMedia||ac.isDataOnly){ae();return}var ad={};if(ac.localPeerSdpConstraints.OfferToReceiveAudio){ad.audio=P.mediaConstraints.audio}if(ac.localPeerSdpConstraints.OfferToReceiveVideo){ad.video=P.mediaConstraints.video}var ab=ac.session||P.session;if(ab.oneway&&ab.audio!=="two-way"&&ab.video!=="two-way"&&ab.screen!=="two-way"){ae();return}if(ab.oneway&&ab.audio&&ab.audio==="two-way"){ab={audio:true}}if(ab.audio||ab.video||ab.screen){if(ab.screen){if(DetectRTC.browser.name==="Edge"){navigator.getDisplayMedia({video:true,audio:j(P)}).then(function(af){af.isScreen=true;T.onGettingLocalMedia(af);if((ab.audio||ab.video)&&!j(P)){P.invokeGetUserMedia(null,ae)}else{ae(af)}},function(af){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")})}else{P.invokeGetUserMedia({audio:j(P),video:true,isScreen:true},(ab.audio||ab.video)&&!j(P)?P.invokeGetUserMedia(null,ae):ae)}}else{if(ab.audio||ab.video){P.invokeGetUserMedia(null,ae,ab)}}}}P.getUserMedia=P.captureUserMedia=function(ad,ac){ad=ad||function(){};var ab=ac||P.session;if(P.dontCaptureUserMedia||t(ab)){ad();return}if(ab.audio||ab.video||ab.screen){if(ab.screen){if(DetectRTC.browser.name==="Edge"){navigator.getDisplayMedia({video:true,audio:j(P)}).then(function(ae){ae.isScreen=true;T.onGettingLocalMedia(ae);if((ab.audio||ab.video)&&!j(P)){var ag={};for(var af in ab){if(af!=="screen"){ag[af]=ab[af]}}P.invokeGetUserMedia(ac,ad,ag);return}ad(ae)},function(ae){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")})}else{P.invokeGetUserMedia({audio:j(P),video:true,isScreen:true},function(ag){if((ab.audio||ab.video)&&!j(P)){var af={};for(var ae in ab){if(ae!=="screen"){af[ae]=ab[ae]}}P.invokeGetUserMedia(ac,ad,af);return}ad(ag)})}}else{if(ab.audio||ab.video){P.invokeGetUserMedia(ac,ad,ab)}}}};P.onbeforeunload=function(ab,ac){if(!P.closeBeforeUnload){return}P.peers.getAllParticipants().forEach(function(ad){T.onNegotiationNeeded({userLeft:true},ad);if(P.peers[ad]&&P.peers[ad].peer){P.peers[ad].peer.close()}delete P.peers[ad]});if(!ac){P.closeSocket()}P.isInitiator=false};if(!window.ignoreBeforeUnload){P.closeBeforeUnload=true;window.addEventListener("beforeunload",P.onbeforeunload,false)}else{P.closeBeforeUnload=false}P.userid=B();P.changeUserId=function(ab,ac){ac=ac||function(){};P.userid=ab||B();P.socket.emit("changed-uuid",P.userid,ac)};P.extra={};P.attachStreams=[];P.session={audio:true,video:true};P.enableFileSharing=false;P.bandwidth={screen:false,audio:false,video:false};P.codecs={audio:"opus",video:"VP9"};P.processSdp=function(ab){if(p()){return ab}if(DetectRTC.browser.name==="Safari"){return ab}if(P.codecs.video.toUpperCase()==="VP8"){ab=e.preferCodec(ab,"vp8")}if(P.codecs.video.toUpperCase()==="VP9"){ab=e.preferCodec(ab,"vp9")}if(P.codecs.video.toUpperCase()==="H264"){ab=e.preferCodec(ab,"h264")}if(P.codecs.audio==="G722"){ab=e.removeNonG722(ab)}if(DetectRTC.browser.name==="Firefox"){return ab}if(P.bandwidth.video||P.bandwidth.screen){ab=e.setApplicationSpecificBandwidth(ab,P.bandwidth,!!P.session.screen)}if(P.bandwidth.video){ab=e.setVideoBitrates(ab,{min:P.bandwidth.video*8*1024,max:P.bandwidth.video*8*1024})}if(P.bandwidth.audio){ab=e.setOpusAttributes(ab,{maxaveragebitrate:P.bandwidth.audio*8*1024,maxplaybackrate:P.bandwidth.audio*8*1024,stereo:1,maxptime:3})}return ab};if(typeof e!=="undefined"){P.BandwidthHandler=P.CodecsHandler=e}P.mediaConstraints={audio:{mandatory:{},optional:P.bandwidth.audio?[{bandwidth:P.bandwidth.audio*8*1024||128*8*1024}]:[]},video:{mandatory:{},optional:P.bandwidth.video?[{bandwidth:P.bandwidth.video*8*1024||128*8*1024},{facingMode:"user"}]:[{facingMode:"user"}]}};if(DetectRTC.browser.name==="Firefox"){P.mediaConstraints={audio:true,video:true}}if(!w.useDefaultDevices&&!DetectRTC.isMobileDevice){DetectRTC.load(function(){var ad,ac;DetectRTC.MediaDevices.forEach(function(ae){if(ae.kind==="audioinput"&&P.mediaConstraints.audio!==false){ad=ae}if(ae.kind==="videoinput"&&P.mediaConstraints.video!==false){ac=ae}});if(ad){if(DetectRTC.browser.name==="Firefox"){if(P.mediaConstraints.audio!==true){P.mediaConstraints.audio.deviceId=ad.id}else{P.mediaConstraints.audio={deviceId:ad.id}}return}if(P.mediaConstraints.audio==true){P.mediaConstraints.audio={mandatory:{},optional:[]}}if(!P.mediaConstraints.audio.optional){P.mediaConstraints.audio.optional=[]}var ab=[{sourceId:ad.id}];P.mediaConstraints.audio.optional=ab.concat(P.mediaConstraints.audio.optional)}if(ac){if(DetectRTC.browser.name==="Firefox"){if(P.mediaConstraints.video!==true){P.mediaConstraints.video.deviceId=ac.id}else{P.mediaConstraints.video={deviceId:ac.id}}return}if(P.mediaConstraints.video==true){P.mediaConstraints.video={mandatory:{},optional:[]}}if(!P.mediaConstraints.video.optional){P.mediaConstraints.video.optional=[]}var ab=[{sourceId:ac.id}];P.mediaConstraints.video.optional=ab.concat(P.mediaConstraints.video.optional)}})}P.sdpConstraints={mandatory:{OfferToReceiveAudio:true,OfferToReceiveVideo:true},optional:[{VoiceActivityDetection:false}]};P.sdpSemantics=null;P.iceCandidatePoolSize=null;P.bundlePolicy=null;P.rtcpMuxPolicy=null;P.iceTransportPolicy=null;P.optionalArgument={optional:[{DtlsSrtpKeyAgreement:true},{googImprovedWifiBwe:true},{googScreencastMinBitrate:300},{googIPv6:true},{googDscp:true},{googCpuUnderuseThreshold:55},{googCpuOveruseThreshold:85},{googSuspendBelowMinBitrate:true},{googCpuOveruseDetection:true}],mandatory:{}};P.iceServers=G.getIceServers(P);P.candidates={host:true,stun:true,turn:true};P.iceProtocols={tcp:true,udp:true};P.onopen=function(ab){if(!!P.enableLogs){console.info("Data connection has been opened between you & ",ab.userid)}};P.onclose=function(ab){if(!!P.enableLogs){console.warn("Data connection has been closed between you & ",ab.userid)}};P.onerror=function(ab){if(!!P.enableLogs){console.error(ab.userid,"data-error",ab)}};P.onmessage=function(ab){if(!!P.enableLogs){console.debug("data-message",ab.userid,ab.data)}};P.send=function(ab,ac){P.peers.send(ab,ac)};P.close=P.disconnect=P.leave=function(){P.onbeforeunload(false,true)};P.closeEntireSession=function(ac){ac=ac||function(){};P.socket.emit("close-entire-session",function ab(){if(P.getAllParticipants().length){setTimeout(ab,100);return}P.onEntireSessionClosed({sessionid:P.sessionid,userid:P.userid,extra:P.extra});P.changeUserId(null,function(){P.close();ac()})})};P.onEntireSessionClosed=function(ab){if(!P.enableLogs){return}console.info("Entire session is closed: ",ab.sessionid,ab.extra)};P.onstream=function(ad){var ab=P.videosContainer;ab.insertBefore(ad.mediaElement,ab.firstChild);var ac=ad.mediaElement.play();if(typeof ac!=="undefined"){ac.catch(function(){}).then(function(){setTimeout(function(){ad.mediaElement.play()},2000)});return}setTimeout(function(){ad.mediaElement.play()},2000)};P.onstreamended=function(ab){if(!ab.mediaElement){ab.mediaElement=document.getElementById(ab.streamid)}if(!ab.mediaElement||!ab.mediaElement.parentNode){return}ab.mediaElement.parentNode.removeChild(ab.mediaElement)};P.direction="many-to-many";P.removeStream=function(ab,ac){var ad;P.attachStreams.forEach(function(ae){if(ae.id===ab){ad=ae}});if(!ad){console.warn("No such stream exist.",ab);return}P.peers.getAllParticipants().forEach(function(ae){if(ac&&ae!==ac){return}var af=P.peers[ae];try{af.peer.removeStream(ad)}catch(ag){}});P.renegotiate()};P.addStream=function(ad,ac){if(!!ad.getTracks){if(P.attachStreams.indexOf(ad)===-1){if(!ad.streamid){ad.streamid=ad.id}P.attachStreams.push(ad)}P.renegotiate(ac);return}if(t(ad)){P.renegotiate(ac);return}if(ad.audio||ad.video||ad.screen){if(ad.screen){if(DetectRTC.browser.name==="Edge"){navigator.getDisplayMedia({video:true,audio:j(P)}).then(function(ae){ae.isScreen=true;T.onGettingLocalMedia(ae);if((ad.audio||ad.video)&&!j(P)){P.invokeGetUserMedia(null,function(af){ab(af)})}else{ab(ae)}},function(ae){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")})}else{P.invokeGetUserMedia({audio:j(P),video:true,isScreen:true},function(ae){if((ad.audio||ad.video)&&!j(P)){P.invokeGetUserMedia(null,function(af){ab(af)})}else{ab(ae)}})}}else{if(ad.audio||ad.video){P.invokeGetUserMedia(null,ab)}}}function ab(ae){if(ad.streamCallback){ad.streamCallback(ae)}P.renegotiate(ac)}};P.invokeGetUserMedia=function(ad,ac,ab){if(!ab){ab=P.session}if(!ad){ad=P.mediaConstraints}M({onGettingLocalMedia:function(af){var ae=ad.video;if(ae){if(ae.mediaSource||ae.mozMediaSource){af.isScreen=true}else{if(ae.mandatory&&ae.mandatory.chromeMediaSource){af.isScreen=true}}}if(!af.isScreen){af.isVideo=!!r(af,"video").length;af.isAudio=!af.isVideo&&r(af,"audio").length}T.onGettingLocalMedia(af,function(){if(typeof ac==="function"){ac(af)}})},onLocalMediaError:function(ae,af){T.onLocalMediaError(ae,af)},localMediaConstraints:ad||{audio:ab.audio?ad.audio:false,video:ab.video?ad.video:false}})};function aa(ac,ab){if(!ac){if(!!P.enableLogs){console.error("No stream to applyConstraints.")}return}if(ab.audio){r(ac,"audio").forEach(function(ad){ad.applyConstraints(ab.audio)})}if(ab.video){r(ac,"video").forEach(function(ad){ad.applyConstraints(ab.video)})}}P.applyConstraints=function(ac,ab){if(!a||!a.prototype.applyConstraints){alert("track.applyConstraints is NOT supported in your browser.");return}if(ab){var ad;if(P.streamEvents[ab]){ad=P.streamEvents[ab].stream}aa(ad,ac);return}P.attachStreams.forEach(function(ae){aa(ae,ac)})};function S(ab,ad,ac){if(ad){T.replaceTrack(ab,ad,ac);return}P.peers.getAllParticipants().forEach(function(ae){T.replaceTrack(ab,ae,ac)})}P.replaceTrack=function(ae,ad,ac){ae=ae||{};if(!L.prototype.getSenders){P.addStream(ae);return}if(ae instanceof a){S(ae,ad,ac);return}if(ae instanceof b){if(r(ae,"video").length){S(r(ae,"video")[0],ad,true)}if(r(ae,"audio").length){S(r(ae,"audio")[0],ad,false)}return}if(t(ae)){throw"connection.replaceTrack requires audio and/or video and/or screen.";return}if(ae.audio||ae.video||ae.screen){if(ae.screen){if(DetectRTC.browser.name==="Edge"){navigator.getDisplayMedia({video:true,audio:j(P)}).then(function(af){af.isScreen=true;T.onGettingLocalMedia(af);if((ae.audio||ae.video)&&!j(P)){P.invokeGetUserMedia(null,ab)}else{ab(af)}},function(af){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")})}else{P.invokeGetUserMedia({audio:j(P),video:true,isScreen:true},(ae.audio||ae.video)&&!j(P)?P.invokeGetUserMedia(null,ab):ab)}}else{if(ae.audio||ae.video){P.invokeGetUserMedia(null,ab)}}}function ab(af){P.replaceTrack(af,ad,ac||ae.video||ae.screen)}};P.resetTrack=function(ab,ac){if(!ab){ab=P.getAllParticipants()}if(typeof ab=="string"){ab=[ab]}ab.forEach(function(ad){var ae=P.peers[ad].peer;if((typeof ac==="undefined"||ac===true)&&ae.lastVideoTrack){P.replaceTrack(ae.lastVideoTrack,ad,true)}if((typeof ac==="undefined"||ac===false)&&ae.lastAudioTrack){P.replaceTrack(ae.lastAudioTrack,ad,false)}})};P.renegotiate=function(ab){if(ab){T.renegotiatePeer(ab);return}P.peers.getAllParticipants().forEach(function(ac){T.renegotiatePeer(ac)})};P.setStreamEndHandler=function(ad,ab){if(!ad||!ad.addEventListener){return}ab=!!ab;if(ad.alreadySetEndHandler){return}ad.alreadySetEndHandler=true;var ac="ended";if("oninactive" in ad){ac="inactive"}ad.addEventListener(ac,function(){if(ad.idInstance){currentUserMediaRequest.remove(ad.idInstance)}if(!ab){var ag=[];P.attachStreams.forEach(function(ah){if(ah.id!=ad.id){ag.push(ah)}});P.attachStreams=ag}var ae=P.streamEvents[ad.streamid];if(!ae){ae={stream:ad,streamid:ad.streamid,type:ab?"remote":"local",userid:P.userid,extra:P.extra,mediaElement:P.streamEvents[ad.streamid]?P.streamEvents[ad.streamid].mediaElement:null}}if(ab&&P.peers[ae.userid]){var af=P.peers[ae.userid].peer;var ag=[];af.getRemoteStreams().forEach(function(ah){if(ah.id!=ad.id){ag.push(ah)}});P.peers[ae.userid].streams=ag}if(ae.userid===P.userid&&ae.type==="remote"){return}if(P.peersBackup[ae.userid]){ae.extra=P.peersBackup[ae.userid].extra}P.onstreamended(ae);delete P.streamEvents[ad.streamid]},false)};P.onMediaError=function(ab,ac){if(!!P.enableLogs){console.error(ab,ac)}};P.autoCloseEntireSession=false;P.filesContainer=P.videosContainer=document.body||document.documentElement;P.isInitiator=false;P.shareFile=T.shareFile;if(typeof F!=="undefined"){F.handle(P)}if(typeof J!=="undefined"){J.handle(P)}P.token=B;P.onNewParticipant=function(ac,ab){P.acceptParticipationRequest(ac,ab)};P.acceptParticipationRequest=function(ac,ab){if(ab.successCallback){ab.successCallback();delete ab.successCallback}T.createNewPeer(ac,ab)};if(typeof s!=="undefined"){P.StreamsHandler=s}P.onleave=function(ab){};P.invokeSelectFileDialog=function(ac){var ab=new FileSelector();ab.accept="*.*";ab.selectSingleFile(ac)};P.onmute=function(ac){if(!ac||!ac.mediaElement){return}if(ac.muteType==="both"||ac.muteType==="video"){ac.mediaElement.src=null;var ab=ac.mediaElement.pause();if(typeof ab!=="undefined"){ab.then(function(){ac.mediaElement.poster=ac.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png"})}else{ac.mediaElement.poster=ac.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png"}}else{if(ac.muteType==="audio"){ac.mediaElement.muted=true}}};P.onunmute=function(ab){if(!ab||!ab.mediaElement||!ab.stream){return}if(ab.unmuteType==="both"||ab.unmuteType==="video"){ab.mediaElement.poster=null;ab.mediaElement.srcObject=ab.stream;ab.mediaElement.play()}else{if(ab.unmuteType==="audio"){ab.mediaElement.muted=false}}};P.onExtraDataUpdated=function(ab){ab.status="online";P.onUserStatusChanged(ab,true)};P.getAllParticipants=function(ab){return P.peers.getAllParticipants(ab)};if(typeof s!=="undefined"){s.onSyncNeeded=function(ac,ad,ab){P.peers.getAllParticipants().forEach(function(ae){T.onNegotiationNeeded({streamid:ac,action:ad,streamSyncNeeded:true,type:ab||"both"},ae)})}}P.connectSocket=function(ab){R(ab)};P.closeSocket=function(){try{io.sockets={}}catch(ab){}if(!P.socket){return}if(typeof P.socket.disconnect==="function"){P.socket.disconnect()}if(typeof P.socket.resetProps==="function"){P.socket.resetProps()}P.socket=null};P.getSocket=function(ab){if(!ab&&P.enableLogs){console.warn("getSocket.callback paramter is required.")}ab=ab||function(){};if(!P.socket){R(function(){ab(P.socket)})}else{ab(P.socket)}return P.socket};P.getRemoteStreams=T.getRemoteStreams;var X=["selectFirst","selectAll","forEach"];P.streamEvents={selectFirst:function(ab){return P.streamEvents.selectAll(ab)[0]},selectAll:function(ab){if(!ab){ab={local:true,remote:true,isScreen:true,isAudio:true,isVideo:true}}if(ab=="local"){ab={local:true}}if(ab=="remote"){ab={remote:true}}if(ab=="screen"){ab={isScreen:true}}if(ab=="audio"){ab={isAudio:true}}if(ab=="video"){ab={isVideo:true}}var ac=[];Object.keys(P.streamEvents).forEach(function(ad){var ae=P.streamEvents[ad];if(X.indexOf(ad)!==-1){return}var af=true;if(ab.local&&ae.type==="local"){af=false}if(ab.remote&&ae.type==="remote"){af=false}if(ab.isScreen&&ae.stream.isScreen){af=false}if(ab.isVideo&&ae.stream.isVideo){af=false}if(ab.isAudio&&ae.stream.isAudio){af=false}if(ab.userid&&ae.userid===ab.userid){af=false}if(af===false){ac.push(ae)}});return ac}};P.socketURL="/";P.socketMessageEvent="RTCMultiConnection-Message";P.socketCustomEvent="RTCMultiConnection-Custom-Message";P.DetectRTC=DetectRTC;P.setCustomSocketEvent=function(ab){if(ab){P.socketCustomEvent=ab}if(!P.socket){return}P.socket.emit("set-custom-socket-event-listener",P.socketCustomEvent)};P.getNumberOfBroadcastViewers=function(ab,ac){if(!P.socket||!ab||!ac){return}P.socket.emit("get-number-of-users-in-specific-broadcast",ab,ac)};P.onNumberOfBroadcastViewersUpdated=function(ab){if(!P.enableLogs||!P.isInitiator){return}console.info("Number of broadcast (",ab.broadcastId,") viewers",ab.numberOfBroadcastViewers)};P.onUserStatusChanged=function(ac,ab){if(!!P.enableLogs&&!ab){console.info(ac.userid,ac.status)}};P.getUserMediaHandler=M;P.multiPeersHandler=T;P.enableLogs=true;P.setCustomSocketHandler=function(ab){if(typeof g!=="undefined"){g=ab}};P.chunkSize=40*1000;P.maxParticipantsAllowed=1000;P.disconnectWith=T.disconnectWith;P.checkPresence=function(ab,ac){ab=ab||P.sessionid;if(g.name==="SSEConnection"){SSEConnection.checkPresence(ab,function(ae,af,ad){if(!P.socket){if(!ae){P.userid=af}P.connectSocket(function(){ac(ae,af,ad)});return}ac(ae,af)});return}if(!P.socket){P.connectSocket(function(){P.checkPresence(ab,ac)});return}P.socket.emit("check-presence",ab+"",function(ae,af,ad){if(P.enableLogs){console.log("checkPresence.isRoomExist: ",ae," roomid: ",af)}ac(ae,af,ad)})};P.onReadyForOffer=function(ab,ac){P.multiPeersHandler.createNewPeer(ab,ac)};P.setUserPreferences=function(ab){if(P.dontAttachStream){ab.dontAttachLocalStream=true}if(P.dontGetRemoteStream){ab.dontGetRemoteStream=true}return ab};P.updateExtraData=function(){P.socket.emit("extra-data-updated",P.extra)};P.enableScalableBroadcast=false;P.maxRelayLimitPerUser=3;P.dontCaptureUserMedia=false;P.dontAttachStream=false;P.dontGetRemoteStream=false;P.onReConnecting=function(ab){if(P.enableLogs){console.info("ReConnecting with",ab.userid,"...")}};P.beforeAddingStream=function(ab){return ab};P.beforeRemovingStream=function(ab){return ab};if(typeof isChromeExtensionAvailable!=="undefined"){P.checkIfChromeExtensionAvailable=isChromeExtensionAvailable}if(typeof isFirefoxExtensionAvailable!=="undefined"){P.checkIfChromeExtensionAvailable=isFirefoxExtensionAvailable}if(typeof getChromeExtensionStatus!=="undefined"){P.getChromeExtensionStatus=getChromeExtensionStatus}P.modifyScreenConstraints=function(ab){return ab};P.onPeerStateChanged=function(ab){if(P.enableLogs){if(ab.iceConnectionState.search(/closed|failed/gi)!==-1){console.error("Peer connection is closed between you & ",ab.userid,ab.extra,"state:",ab.iceConnectionState)}}};P.isOnline=true;q("online",function(){P.isOnline=true});q("offline",function(){P.isOnline=false});P.isLowBandwidth=false;if(navigator&&navigator.connection&&navigator.connection.type){P.isLowBandwidth=navigator.connection.type.toString().toLowerCase().search(/wifi|cell/g)!==-1;if(P.isLowBandwidth){P.bandwidth={audio:false,video:false,screen:false};if(P.mediaConstraints.audio&&P.mediaConstraints.audio.optional&&P.mediaConstraints.audio.optional.length){var Z=[];P.mediaConstraints.audio.optional.forEach(function(ab){if(typeof ab.bandwidth==="undefined"){Z.push(ab)}});P.mediaConstraints.audio.optional=Z}if(P.mediaConstraints.video&&P.mediaConstraints.video.optional&&P.mediaConstraints.video.optional.length){var Z=[];P.mediaConstraints.video.optional.forEach(function(ab){if(typeof ab.bandwidth==="undefined"){Z.push(ab)}});P.mediaConstraints.video.optional=Z}}}P.getExtraData=function(ab,ac){if(!ab){throw"remoteUserId is required."}if(typeof ac==="function"){P.socket.emit("get-remote-user-extra-data",ab,function(ad,af,ae){ac(ad,af,ae)});return}if(!P.peers[ab]){if(P.peersBackup[ab]){return P.peersBackup[ab].extra}return{}}return P.peers[ab].extra};if(!!w.autoOpenOrJoin){P.openOrJoin(P.sessionid)}P.onUserIdAlreadyTaken=function(ab,ac){P.close();P.closeSocket();P.isInitiator=false;P.userid=P.token();P.join(P.sessionid);if(P.enableLogs){console.warn("Userid already taken.",ab,"Your new userid:",P.userid)}};P.trickleIce=true;P.version="3.6.9";P.onSettingLocalDescription=function(ab){if(P.enableLogs){console.info("Set local description for remote user",ab.userid)}};P.resetScreen=function(){sourceId=null;if(DetectRTC&&DetectRTC.screen){delete DetectRTC.screen.sourceId}currentUserMediaRequest={streams:[],mutex:false,queueRequests:[]}};P.autoCreateMediaElement=true;P.password=null;P.setPassword=function(ab,ac){ac=ac||function(){};if(P.socket){P.socket.emit("set-password",ab,ac)}else{P.password=ab;ac(true,P.sessionid,null)}};P.onSocketDisconnect=function(ab){if(P.enableLogs){console.warn("socket.io connection is closed")}};P.onSocketError=function(ab){if(P.enableLogs){console.warn("socket.io connection is failed")}};P.errors={ROOM_NOT_AVAILABLE:"Room not available",INVALID_PASSWORD:"Invalid password",USERID_NOT_AVAILABLE:"User ID does not exist",ROOM_PERMISSION_DENIED:"Room permission denied",ROOM_FULL:"Room full",DID_NOT_JOIN_ANY_ROOM:"Did not join any room yet",INVALID_SOCKET:"Invalid socket",PUBLIC_IDENTIFIER_MISSING:"publicRoomIdentifier is required",INVALID_ADMIN_CREDENTIAL:"Invalid username or password attempted"}})(this)};if(typeof module!=="undefined"){module.exports=exports=RTCMultiConnection}if(typeof define==="function"&&define.amd){define("RTCMultiConnection",[],function(){return RTCMultiConnection})};